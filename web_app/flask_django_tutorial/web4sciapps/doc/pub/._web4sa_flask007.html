<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="generator" content="Doconce: http://code.google.com/p/doconce/"/>

    <link rel="stylesheet"
          href="https://raw.githubusercontent.com/hplgit/doconce/master/bundled/html_styles/style_vagrant/css/twitter_bootstrap.css">
    <link rel="stylesheet"
          href="https://raw.githubusercontent.com/hplgit/doconce/master/bundled/html_styles/style_vagrant/css/vagrant.css">
    <!-- Define color of headings here (last definition counts) -->
    <style type="text/css">
h1, h2, h3, h4, h5, h6 {
  color: #000;     /* black */
  color: #999;     /* gray */
  color: #005580;  /* dark blue */
  color: #08c;     /* characteristic blue */

    </style>
</head>
<body>

<title>Using Flask for Scientific Web Applications</title>

<div class="container">
    <div class="row Header with-border">
        <div class="span3 Module logo">
            <h1><a href="/">Flask<span class="subtitle">4scientists</span></a></h1>
        </div>
        <div class="span9">
            <div class="Module navigation">
                <ul>
                    <li><a href="http://flask.pocoo.org/">Flask</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="span3 Module sidebar">
        <div class="well" style="padding: 8px 0px;">
            <ul class="nav nav-list">
                <!-- navigation toc: -->
                <li><a href="._web4sa_flask000.html#___sec0" style="font-size: 80%;">Web frameworks</a></li>
                <!-- navigation toc: -->
                <li><a href="._web4sa_flask004.html#___sec5" style="font-size: 80%;">Making a Flask application</a></li>
                <!-- navigation toc: -->
                <li><a href="._web4sa_flask006.html#wf:vib:flask" style="font-size: 80%;">Handling multiple input
                    variables in Flask</a></li>
                <!-- navigation toc: -->
                <li><a href="._web4sa_flask017.html#___sec56" style="font-size: 80%;">Exercises</a></li>
                <!-- navigation toc: -->
                <li><a href="._web4sa_flask017.html#___sec66" style="font-size: 80%;">Flask resources</a></li>

            </ul>
        </div>
    </div>

    <div class="span9">


        <!-- tocinfo
        {'highest level': 1,
         'sections': [('Web frameworks', 1, None, '___sec0'),
                      ('Other frameworks', 3, None, '___sec1'),
                      ('The MVC pattern', 2, None, '___sec2'),
                      ('A very simple application', 2, None, '___sec3'),
                      ('Application of the MVC pattern', 2, 'wf:hw:mvc', 'wf:hw:mvc'),
                      ('Making a Flask application', 1, None, '___sec5'),
                      ('Programming the Flask application', 2, None, '___sec6'),
                      ('The user interaction', 3, None, '___sec7'),
                      ('The Python code', 3, None, '___sec8'),
                      ('Dissection', 3, None, '___sec9'),
                      ('The template files', 3, None, '___sec10'),
                      ('Testing the application', 3, None, '___sec11'),
                      ('Equipping the input page with output results',
                       2,
                       None,
                       '___sec12'),
                      ('Splitting the app into model, view, and controller files',
                       2,
                       'wf:hw3:flask',
                       'wf:hw3:flask'),
                      ('Troubleshooting', 2, None, '___sec14'),
                      ('Address already in use', 3, None, '___sec15'),
                      ('Handling multiple input variables in Flask',
                       1,
                       'wf:vib:flask',
                       'wf:vib:flask'),
                      ('Programming the Flask application',
                       2,
                       'wf:vib1:flask:app',
                       'wf:vib1:flask:app'),
                      ('The compute part', 3, None, '___sec18'),
                      ('The model', 3, None, '___sec19'),
                      ('The view', 3, None, '___sec20'),
                      ('The HTML template', 3, None, '___sec21'),
                      ('Implementing error checking in the template',
                       2,
                       None,
                       '___sec22'),
                      ('Using style sheets', 2, None, '___sec23'),
                      ('Using LaTeX mathematics', 2, None, '___sec24'),
                      ('Rearranging the elements in the HTML template',
                       2,
                       None,
                       '___sec25'),
                      ('Bootstrap HTML style', 2, None, '___sec26'),
                      ('Custom validation',
                       2,
                       'wf:vib1:flask:validation',
                       'wf:vib1:flask:validation'),
                      ('Using Flask validators', 3, None, '___sec28'),
                      ('Tailored validation', 3, None, '___sec29'),
                      ('Tailored validation of intervals', 3, None, '___sec30'),
                      ('Demo', 3, None, '___sec31'),
                      ('Avoiding plot files',
                       2,
                       'wf:vib2:flask:nofiles',
                       'wf:vib2:flask:nofiles'),
                      ('PNG plots', 3, None, '___sec33'),
                      ('SVG plots', 3, None, '___sec34'),
                      ('Using mpld3', 3, None, '___sec35'),
                      ('Plotting with the Bokeh library',
                       2,
                       'wf:bokeh:flask',
                       'wf:bokeh:flask'),
                      ('Pandas highcharts plotting library', 3, None, '___sec37'),
                      ('Autogenerating the code',
                       2,
                       'wf:autogen:flask',
                       'wf:autogen:flask'),
                      ('Inspecting function signatures', 3, None, '___sec39'),
                      ('Generating the model', 3, None, '___sec40'),
                      ('Generating the view', 3, None, '___sec41'),
                      ('Generating the template', 3, None, '___sec42'),
                      ('Application', 3, None, '___sec43'),
                      ('User login and storage of computed results',
                       2,
                       'wf:flask:login',
                       'wf:flask:login'),
                      ('Required additional software', 3, None, '___sec45'),
                      ('The compute part', 3, None, '___sec46'),
                      ('The interfaces of the app', 3, None, '___sec47'),
                      ('The source code', 3, None, '___sec48'),
                      ('Resources', 3, None, '___sec49'),
                      ('Uploading of files', 2, 'wf:flask:upload', 'wf:flask:upload'),
                      ('Overview of the application', 3, None, '___sec51'),
                      ('The model class', 3, None, '___sec52'),
                      ('The controller file', 3, None, '___sec53'),
                      ('The compute function', 3, None, '___sec54'),
                      ('The HTML template', 3, None, '___sec55'),
                      ('Exercises', 1, None, '___sec56'),
                      ('Exercise 1: Add two numbers',
                       2,
                       'wf:exer:add2',
                       'wf:exer:add2'),
                      ('Exercise 2: Upload data file and visualize curves',
                       2,
                       'wf:exer:upload',
                       'wf:exer:upload'),
                      ('Exercise 3: Plot a user-specified formula',
                       2,
                       'wf:exer:formula',
                       'wf:exer:formula'),
                      ('Exercise 4: Visualize Taylor polynomial approximations',
                       2,
                       'wf:exer:Taylor',
                       'wf:exer:Taylor'),
                      ('Exercise 5: Extend the `gen` app',
                       2,
                       'wf:exer:gen:demo',
                       'wf:exer:gen:demo'),
                      ('Exercise 6: Make a web app with multiple apps',
                       2,
                       'wf:exer:addmul',
                       'wf:exer:addmul'),
                      ('Exercise 7: Equip the `gen` app with more data types',
                       2,
                       'wf:exer:gen:lists',
                       'wf:exer:gen:lists'),
                      ('Exercise 8: Auto-generate code from function signature',
                       2,
                       None,
                       '___sec64'),
                      ('Project 9: Interactive function exploration',
                       2,
                       'wf:exer:bokeh_UI',
                       'wf:exer:bokeh_UI'),
                      ('Flask resources', 1, None, '___sec66')]}
        end of tocinfo -->


        <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "none"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js", "color.js"]
  }
});

        </script>
        <script type="text/javascript"
                src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
        </script>


        <a name="part0007"></a>
        <!-- !split -->

        <h2 id="___sec22">Implementing error checking in the template </h2>

        <p>
            What happens if the user gives wrong input, for instance the letters <code>asd</code>
            instead of a number? Actually nothing! The <code>FloatField</code> object
            checks that the input is compatible with a real number in the
            <code>form.validate()</code> call, but returns just <code>False</code> if this is not
            the case. Looking at the code in <code>controller.py</code>,

        <p>

            <!-- code=python (!bc pycod) typeset with pygments style "default" -->
        <div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span
                style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">index</span>():
    form <span style="color: #666666">=</span> InputForm(request<span style="color: #666666">.</span>form)
    <span style="color: #008000; font-weight: bold">if</span> request<span style="color: #666666">.</span>method <span
                    style="color: #666666">==</span> <span style="color: #BA2121">&#39;POST&#39;</span> <span
                    style="color: #AA22FF; font-weight: bold">and</span> form<span style="color: #666666">.</span>validate():
        result <span style="color: #666666">=</span> compute(form<span style="color: #666666">.</span>A<span
                    style="color: #666666">.</span>data, form<span style="color: #666666">.</span>b<span
                    style="color: #666666">.</span>data,
                         form<span style="color: #666666">.</span>w<span style="color: #666666">.</span>data, form<span
                    style="color: #666666">.</span>T<span style="color: #666666">.</span>data)
    <span style="color: #008000; font-weight: bold">else</span>:
        result <span style="color: #666666">=</span> <span style="color: #008000">None</span>
</pre>
        </div>
        <p>
            we realize that wrong input implies <code>result = None</code> and no computations
            and no plot! Fortunately, each field object gets an attribute <code>error</code>
            with information on errors that occur on input. We can write out
            this information on the web page, as exemplified in the template
            <code>view_errcheck.html</code>:

        <p>

            <!-- code=html (!bc htmlpro) typeset with pygments style "default" -->
        <div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span
                style="color: #008000; font-weight: bold">&lt;form</span> <span
                style="color: #7D9029">method=</span><span style="color: #BA2121">post</span> <span
                style="color: #7D9029">action=</span><span style="color: #BA2121">&quot;&quot;</span><span
                style="color: #008000; font-weight: bold">&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;table&gt;</span>
  {% for field in form %}
    <span style="color: #008000; font-weight: bold">&lt;tr&gt;</span>
    <span style="color: #008000; font-weight: bold">&lt;td&gt;</span>{{ field.name }}<span
                    style="color: #008000; font-weight: bold">&lt;/td&gt;&lt;td&gt;</span>{{ field(size=12) }}<span
                    style="color: #008000; font-weight: bold">&lt;/td&gt;</span>
    <span style="color: #008000; font-weight: bold">&lt;td&gt;</span>{{ field.label }}<span
                    style="color: #008000; font-weight: bold">&lt;/td&gt;</span>
    {% if field.errors %}
      <span style="color: #008000; font-weight: bold">&lt;td&gt;&lt;ul</span> <span style="color: #7D9029">class=</span><span
                    style="color: #BA2121">errors</span><span style="color: #008000; font-weight: bold">&gt;</span>
      {% for error in field.errors %}
        <span style="color: #008000; font-weight: bold">&lt;li&gt;&lt;font</span> <span
                    style="color: #7D9029">color=</span><span style="color: #BA2121">&quot;red&quot;</span><span
                    style="color: #008000; font-weight: bold">&gt;</span>{{ error }}<span
                    style="color: #008000; font-weight: bold">&lt;/font&gt;&lt;/li&gt;</span>
      {% endfor %}<span style="color: #008000; font-weight: bold">&lt;/ul&gt;&lt;/td&gt;</span>
    {% endif %}
    <span style="color: #008000; font-weight: bold">&lt;/tr&gt;</span>
  {% endfor %}
<span style="color: #008000; font-weight: bold">&lt;/table&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;p&gt;&lt;input</span> <span style="color: #7D9029">type=</span><span
                    style="color: #BA2121">submit</span> <span style="color: #7D9029">value=</span><span
                    style="color: #BA2121">Compute</span><span style="color: #008000; font-weight: bold">&gt;&lt;/form&gt;&lt;/p&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;p&gt;</span>
{% if result != None %}
<span style="color: #008000; font-weight: bold">&lt;img</span> <span style="color: #7D9029">src=</span><span
                    style="color: #BA2121">&quot;{{ result }}&quot;</span> <span
                    style="color: #7D9029">width=</span><span style="color: #BA2121">&quot;500&quot;</span><span
                    style="color: #008000; font-weight: bold">&gt;</span>
{% endif %}
<span style="color: #008000; font-weight: bold">&lt;/p&gt;</span>
</pre>
        </div>
        <p>
            Two things are worth noticing here:

        <ol>
            <li> We can control the width of the text field where the
                user writes the numbers, here set to 12 characters.
            </li>
            <li> We can make an extra column in the HTML table with a list
                of possible errors for each field object.
            </li>
        </ol>

        Let us test the error handling of the <code>A</code> field by
        writing <code>asd</code> instead of a number. This input
        triggers an error, whose message is written in red to the right of the label,
        see Figure <a href="#wf:vib1:flask:fig:error1">6</a>.

        <p>
            <center> <!-- figure -->
                <hr class="figure">
                <center>
        <p class="caption">Figure 6: Error message because of wrong input.
        <div id="wf:vib1:flask:fig:error1"></div>
        </p></center>
        <p><img src="fig-web4sa/vib1_flask_error1.png" align="bottom" width=500></p>
        </center>

        <p>
            It is possible to use the additional HTML5 fields for input in a Flask
            context. Instead of explaining how here, we recommend to use the
            <a href="https://github.com/hplgit/parampool" target="_self">Parampool</a>
            package to automatically generate Flask files with HTML5 fields.

        <p>
        <p>
            <!-- navigation buttons at the bottom of the page -->
        <ul class="pager">
            <li class="previous">
                <a href="._web4sa_flask006.html">&larr; Prev</a>
            </li>
            <li class="next">
                <a href="._web4sa_flask008.html">Next &rarr;</a>
            </li>
        </ul>
        <!-- ------------------- end of main content --------------- -->


    </div>

    <div class="row Footer">
        <div class="span12">
            &copy 2013; Hans Petter Langtangen and Anders E. Johansen.
            Last update: Oct 11, 2015.
        </div>
    </div>
</div>
</body>
</html>

