<!DOCTYPE html>
<!--
Automatically generated HTML file from Doconce source
(https://github.com/hplgit/doconce/)
-->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="generator" content="Doconce: https://github.com/hplgit/doconce/"/>
    <meta name="description" content="Using Web Frameworks for Scientific Web Applications">
    <meta name="keywords"
          content="web frameworks,MVC pattern,Flask installation,Flask input forms,Flask HTML templates,Flask MVC pattern,Flask troubleshooting,Django installation,Django making a project,Django making an application,Django input forms,Django HTML templates,Flask input forms,Flask error checking,Flask CSS style sheets,Flask LaTeX mathematics,Flask input validation,inline PNG image in HTML,base64 encoding of PNG images,inline SVG figure in HTML,Django input forms,Django input validation">


    <style type="text/css">
    /* bloodish style */

    body {
      font-family: Helvetica, Verdana, Arial, Sans-serif;
      color: #404040;
      background: #ffffff;
    }
    h1 { font-size: 1.8em;  color: #8A0808; }
    h2 { font-size: 1.6em;  color: #8A0808; }
    h3 { font-size: 1.4em;  color: #8A0808; }
    h4 { color: #8A0808; }
    a { color: #8A0808; text-decoration:none; }
    tt { font-family: "Courier New", Courier; }
    
    p { text-indent: 0px; }
    hr { border: 0; width: 80%; border-bottom: 1px solid #aaa}
    p.caption { width: 80%; font-style: normal; text-align: left; }
    hr.figure { border: 0; width: 80%; border-bottom: 1px solid #aaa}


    </style>

</head>

<!-- tocinfo
{'highest level': 1,
 'sections': [(' Web frameworks ', 1, None, '___sec0'),
              (' The MVC pattern ', 2, None, '___sec1'),
              (' A very simple application ', 2, None, '___sec2'),
              (' Application of the MVC pattern ',
               2,
               'wf:hw:mvc',
               'wf:hw:mvc'),
              (' Making a Flask application ', 1, None, '___sec4'),
              (' Programming the Flask application ', 2, None, '___sec5'),
              (' Equipping the input page with output results ',
               2,
               None,
               '___sec6'),
              (' Splitting the app into model, view, and controller files ',
               2,
               'wf:hw3:flask',
               'wf:hw3:flask'),
              (' Troubleshooting ', 2, None, '___sec8'),
              (' Making a Django application ', 1, None, '___sec9'),
              (' Setting up a Django project ', 2, None, '___sec10'),
              (' Setting up a Django application ', 2, None, '___sec11'),
              (' Programming the Django application ', 2, None, '___sec12'),
              (' Equipping the input page with output results ',
               2,
               None,
               '___sec13'),
              (' Handling multiple input variables in Flask ',
               1,
               'wf:vib:flask',
               'wf:vib:flask'),
              (' Programming the Flask application ',
               2,
               'wf:vib1:flask:app',
               'wf:vib1:flask:app'),
              (' Implementing error checking in the template ',
               2,
               None,
               '___sec16'),
              (' Using style sheets ', 2, None, '___sec17'),
              (' Using LaTeX mathematics ', 2, None, '___sec18'),
              (' Rearringing the elements in the HTML template ',
               2,
               None,
               '___sec19'),
              (' User-provided validation ',
               2,
               'wf:vib1:flask:validation',
               'wf:vib1:flask:validation'),
              (' Autogenerating the code ',
               2,
               'wf:vib3:flask:autogen',
               'wf:vib3:flask:autogen'),
              (' Avoiding plot files ',
               2,
               'wf:vib3:flask:nofiles',
               'wf:vib3:flask:nofiles'),
              (' PNG plots ', 3, None, '___sec23'),
              (' SVG plots ', 3, None, '___sec24'),
              (' Further work ', 1, None, '___sec25'),
              (' Handling multiple input variables in Django ',
               1,
               'wf:vib:django',
               'wf:vib:django'),
              (' Programming the Django application ', 2, None, '___sec27'),
              (' User-provided validation ', 2, None, '___sec28'),
              (' Customizing widgets ', 2, None, '___sec29'),
              (' Exercises ', 1, None, '___sec30'),
              (' Exercise 1: Add two numbers ',
               2,
               'wf:exer:add2',
               'wf:exer:add2'),
              (' Exercise 2: Extend the `vib3_flask` app ',
               2,
               'wf:exer:vib3:demo',
               'wf:exer:vib3:demo'),
              (' Exercise 3: Equip the `vib3_flask` app with more data types ',
               2,
               'wf:exer:vib3:lists',
               'wf:exer:vib3:lists'),
              (' Exercise 4: Auto-generate code from function signature ',
               2,
               None,
               '___sec34'),
              (' Resources ', 1, None, '___sec35'),
              (' Flask resources ', 2, None, '___sec36'),
              (' Django resources ', 2, None, '___sec37'),
              (' Remaining ', 1, None, '___sec38')]}
end of tocinfo -->

<body>


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "none"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js"]
  }
});

</script>
<script type="text/javascript"
        src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- Fix slow MathJax rendering in IE8 -->
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7">


<a name="part0013"></a>
<!-- begin top navigation -->
<a href="._part0012_web4sa_plain.html"><img src="http://hplgit.github.io/doconce/bundled/html_images/prev1.png" border=0
                                            alt="previous"></a>

<a href="._part0014_web4sa_plain.html"><img src="http://hplgit.github.io/doconce/bundled/html_images/next1.png" border=0
                                            alt="next"></a>
<!-- end top navigation -->

<p>
    <!-- !split -->

<h3>Avoiding plot files <a name="wf:vib3:flask:nofiles"></a></h3>

<p>
    Files with plots are easy to deal with as long as they are in the
    <code>static</code> subdirectory of the Flask application directory. However,
    the less files a web app makes use of, the better. Also, the problem
    with ensuring that new plots are really loaded into the browser
    required us to generate unique filenames. Therefore, it would be
    convenient to get the plot as a string and embed the string data
    directly into the HTML code. This is relatively easy with Matplotlib
    and Python. The relevant code constitutes the
    <a href="https://github.com/hplgit/web4sciapps/tree/master/doc/src/web4sa/src-web4sa/apps/flask_apps/vib4"
       target="_self"><tt>vib4</tt></a> app in the
    directory of the same name.

<h4>PNG plots <a name="___sec23"></a></h4>

<p>
    Python has the <code>StringIO</code> object that is a string buffer with the
    look and behavior of a file. The idea is to let Matplotlib write to
    a <code>StringIO</code> object and afterwards extract the string from this object:

<p>

    <!-- code=python (from !bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span
        style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">matplotlib.pyplot</span> <span
        style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">plot</span>
<span style="color: #008000; font-weight: bold">from</span> <span
            style="color: #0000FF; font-weight: bold">StringIO</span> <span style="color: #008000; font-weight: bold">import</span> StringIO
<span style="color: #408080; font-style: italic"># run plt.plot, plt.title, etc.</span>
figfile <span style="color: #666666">=</span> StringIO()
plt<span style="color: #666666">.</span>savefig(figfile, format<span style="color: #666666">=</span><span
            style="color: #BA2121">&#39;png&#39;</span>)
figfile<span style="color: #666666">.</span>seek(<span style="color: #666666">0</span>)  <span
            style="color: #408080; font-style: italic"># rewind to beginning of file</span>
figdata_png <span style="color: #666666">=</span> figfile<span style="color: #666666">.</span>buf  <span
            style="color: #408080; font-style: italic"># extract string</span>
</pre>
</div>
<p>
    Before the PNG data can be embedded in HTML we need to convert the
    data to base64 format:

<p>

    <!-- code=python (from !bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span
        style="color: #008000; font-weight: bold">import</span> <span
        style="color: #0000FF; font-weight: bold">base64</span>
figdata_png <span style="color: #666666">=</span> base64<span style="color: #666666">.</span>b64encode(figdata_png)
</pre>
</div>
<p>
    Now we can embed the PNG data in HTML by

<p>

    <!-- code=python (from !bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span
        style="color: #408080; font-style: italic"># html is some file object for the HTML file</span>
html<span style="color: #666666">.</span>write(<span style="color: #BA2121">&quot;&quot;&quot;</span>
<span style="color: #BA2121">&lt;img src=&quot;data:image/png;base64,</span><span
            style="color: #BB6688; font-weight: bold">%(figdata_png)s</span><span style="color: #BA2121">&quot; width=500&gt;</span>
<span style="color: #BA2121">&quot;&quot;&quot;</span> <span style="color: #666666">%</span> <span
            style="color: #008000">vars</span>())
</pre>
</div>
<p>
    The corresponding syntax in an HTML template is

<p>

    <!-- code=html (from !bc htmlcod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span
        style="color: #008000; font-weight: bold">&lt;img</span> <span style="color: #7D9029">src=</span><span
        style="color: #BA2121">&quot;data:image/png;base64,{{ figdata_png }}&quot;</span> <span style="color: #7D9029">width=</span><span
        style="color: #BA2121">500</span><span style="color: #008000; font-weight: bold">&gt;</span>
</pre>
</div>

<h4>SVG plots <a name="___sec24"></a></h4>

<p>
    Inline figures in HTML, instead of using files, are most often realized
    by XML code with the figure data in SVG format.
    Plot strings in the SVG format are created very similarly to the PNG
    example:

<p>

    <!-- code=python (from !bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">figfile <span
        style="color: #666666">=</span> StringIO()
plt<span style="color: #666666">.</span>savefig(figfile, format<span style="color: #666666">=</span><span
            style="color: #BA2121">&#39;svg&#39;</span>)
figdata_svg <span style="color: #666666">=</span> figfile<span style="color: #666666">.</span>buf
</pre>
</div>
<p>
    The <code>figdata_svg</code> string contains XML code text can almost
    be directly embedded in
    HTML5. However, the beginning of the text contains information before
    the <code>svg</code> tag that we want to remove:

<p>

    <!-- code=text (from !bc dat) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; standalone=&quot;no&quot;?&gt;
&lt;!DOCTYPE svg PUBLIC &quot;-//W3C//DTD SVG 1.1//EN&quot;
  &quot;http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd&quot;&gt;
&lt;!-- Created with matplotlib (http://matplotlib.sourceforge.net/) --&gt;
&lt;svg height=&quot;441pt&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 585 441&quot; ...
</pre>
</div>
<p>
    The removal is done with a little string manipulation:

<p>

    <!-- code=python (from !bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">figdata_svg <span
        style="color: #666666">=</span> <span style="color: #BA2121">&#39;&lt;svg&#39;</span> <span
        style="color: #666666">+</span> figfile<span style="color: #666666">.</span>buf<span
        style="color: #666666">.</span>split(<span style="color: #BA2121">&#39;&lt;svg&#39;</span>)[<span
        style="color: #666666">1</span>]
</pre>
</div>
<p>
    Now, <code>figdata_svg</code> can be directly inserted in HTML code without
    any surrounding tags.
    The file <a
        href="https://github.com/hplgit/web4sciapps/tree/master/doc/src/web4sa/src-web4sa/apps/flask_apps/vib4/compute.py"
        target="_self"><tt>compute.py</tt></a>
    in the <code>vib4_flask</code> application directory contains all the details.

<p>
    The <code>compute_gamma</code> function returns six values:
    the PNG data for the \( g \) plot, the PNG data for the \( G \) plot,
    the SVG XML code for the \( g \) plot, the SVG XML code for the \( G \) plot,
    the mean value, and the value of the standard deviation. We can
    keep the <code>controller.py</code> unchanged (except for the URL, which is now <code>vib4</code>)
    and adjust the <code>view_results.html</code>
    template only. The <code>result</code> object is now a tuple with 6 elements.
    For illustration purposes we make two rows with plots, one with
    PNG data and one with SVG data. The template becomes

<p>

    <!-- code=html (from !bc htmlpro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">{% if result != None %}
<span style="color: #008000; font-weight: bold">&lt;p&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;table&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;tr&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;td&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;img</span> <span style="color: #7D9029">src=</span><span
            style="color: #BA2121">&quot;data:image/png;base64,{{ result[0] }}&quot;</span> <span
            style="color: #7D9029">width=</span><span style="color: #BA2121">&quot;400&quot;</span><span
            style="color: #008000; font-weight: bold">&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;/td&gt;&lt;td&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;img</span> <span style="color: #7D9029">src=</span><span
            style="color: #BA2121">&quot;data:image/png;base64,{{ result[1] }}&quot;</span> <span
            style="color: #7D9029">width=</span><span style="color: #BA2121">&quot;400&quot;</span><span
            style="color: #008000; font-weight: bold">&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;/td&gt;&lt;/tr&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;tr&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;td&gt;</span>{{ result[2]|safe }}<span
            style="color: #008000; font-weight: bold">&lt;/td&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;td&gt;</span>{{ result[3]|safe }}<span
            style="color: #008000; font-weight: bold">&lt;/td&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;/tr&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;tr&gt;&lt;td&gt;</span>
Mean value: {{ result[4] }} <span style="color: #008000; font-weight: bold">&lt;br&gt;</span>
Standard deviation value: {{ result[5] }}
<span style="color: #008000; font-weight: bold">&lt;/td&gt;&lt;/tr&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;/table&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;/p&gt;</span>
{% endif %}
</pre>
</div>
<p>
    Special HTML characters like <code><</code>, <code>></code>,
    <code>&</code>, <code>"</code>, and <code>'</code> are escaped in a template string like <code>{{ str }}</code>
    (i.e., <code>&</code> is replaced by <code>&amp;</code> `<` is replaced by <code>&lt;</code>, etc.).
    We need to avoid this manipulation of the string content
    because <code>result[2]</code> and <code>result[3]</code> contain
    XML code where the mentioned characters are essential part of the syntax.
    Writing <code>{{str|safe}}</code> ensures that the contents of the string <code>str</code>
    are not altered before being embedded in the HTML text.

<p>
    Trying out the <code>vib4_flask</code> application we see that the SVG plots are
    much bigger than the width-controlled PNG plots.
    The width and height of SVG plots are specified in the XML code and can
    of course be changed by proper string replacements for the
    <code>width</code>, <code>height</code>, and <code>viewBox</code> specifications. It is far easier to
    just write the <code>width</code> specification in the image tag for the PNG plot.

<h2>Further work <a name="___sec25"></a></h2>

<p>

<ul>
    <li> Uploading of files: Just one button for a data file where we
        compute mean and variance, see the average function but drop
        the array argument.
    </li>
    <li> Log in and users. use a simple "compute" function to generate
        code, just a textarea (string) that can be stored (diary).
        This requires databases. Can generate a vib example via parampool to
        display some more realistic code.
    </li>
    <li> Drawing in HTML5</li>
</ul>

Resources:

<p>

<ul>
    <li><a href="https://docs.djangoproject.com/en/dev/topics/auth/default/#user-objects" target="_self">Django: make
        user</a></li>
    <li><a href="https://docs.djangoproject.com/en/dev/topics/db/queries/" target="_self">Django: read and write
        database</a></li>
    <li> Flask: read and write database:
        <a href="http://pythonhosted.org/Flask-SQLAlchemy/quickstart.html" target="_self"><tt>http://pythonhosted.org/Flask-SQLAlchemy/quickstart.html</tt></a>,
        <a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-iv-database" target="_self"><tt>http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-iv-database</tt></a>,
        and <a href="https://flask-login.readthedocs.org/en/latest/" target="_self">the Flask login extension</a></li>
</ul>

<p>
    <!-- begin bottom navigation -->
    <a href="._part0012_web4sa_plain.html"><img src="http://hplgit.github.io/doconce/bundled/html_images/prev1.png"
                                                border=0 alt="previous"></a>

    <a href="._part0014_web4sa_plain.html"><img src="http://hplgit.github.io/doconce/bundled/html_images/next1.png"
                                                border=0 alt="next"></a>
    <!-- end bottom navigation -->

    <!-- ------------------- end of main content --------------- -->


</body>
</html>
    

