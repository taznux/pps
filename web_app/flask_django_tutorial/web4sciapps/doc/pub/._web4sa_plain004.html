<!--
Automatically generated HTML file from DocOnce source
(https://github.com/hplgit/doconce/)
-->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="generator" content="DocOnce: https://github.com/hplgit/doconce/"/>
    <meta name="description" content="Using Web Frameworks for Scientific Applications">
    <meta name="keywords"
          content="web frameworks,MVC pattern,Flask installation,Flask input forms,Flask HTML templates,Flask MVC pattern,Flask troubleshooting,Django installation,Django making a project,Django making an application,Django input forms,Django HTML templates,Flask input forms,Flask error checking,Flask CSS style sheets,Flask LaTeX mathematics,Flask input validation,inline PNG image in HTML,base64 encoding of PNG images,inline SVG figure in HTML,mpld3 plotting,Flask Bokeh plotting,Bokeh plotting,highcharts,Flask login,Flask database,Flask uploading of files,Flask file upload,Django input forms,Django input validation">

    <title>Using Web Frameworks for Scientific Applications</title>


    <style type="text/css">
/* bloodish style */

body {
  font-family: Helvetica, Verdana, Arial, Sans-serif;
  color: #404040;
  background: #ffffff;
}
h1 { font-size: 1.8em;  color: #8A0808; }
h2 { font-size: 1.6em;  color: #8A0808; }
h3 { font-size: 1.4em;  color: #8A0808; }
h4 { color: #8A0808; }
a { color: #8A0808; text-decoration:none; }
tt { font-family: "Courier New", Courier; }
/* pre style removed because it will interfer with pygments */
p { text-indent: 0px; }
hr { border: 0; width: 80%; border-bottom: 1px solid #aaa}
p.caption { width: 80%; font-style: normal; text-align: left; }
hr.figure { border: 0; width: 80%; border-bottom: 1px solid #aaa}
.alert-text-small   { font-size: 80%;  }
.alert-text-large   { font-size: 130%; }
.alert-text-normal  { font-size: 90%;  }
.alert {
  padding:8px 35px 8px 14px; margin-bottom:18px;
  text-shadow:0 1px 0 rgba(255,255,255,0.5);
  border:1px solid #bababa;
  border-radius: 4px;
  -webkit-border-radius: 4px;
  -moz-border-radius: 4px;
  color: #555;
  background-color: #f8f8f8;
  background-position: 10px 5px;
  background-repeat: no-repeat;
  background-size: 38px;
  padding-left: 55px;
  width: 75%;
 }
.alert-block {padding-top:14px; padding-bottom:14px}
.alert-block > p, .alert-block > ul {margin-bottom:1em}
.alert li {margin-top: 1em}
.alert-block p+p {margin-top:5px}
.alert-notice { background-image: url(https://cdn.rawgit.com/hplgit/doconce/master/bundled/html_images/small_gray_notice.png); }
.alert-summary  { background-image:url(https://cdn.rawgit.com/hplgit/doconce/master/bundled/html_images/small_gray_summary.png); }
.alert-warning { background-image: url(https://cdn.rawgit.com/hplgit/doconce/master/bundled/html_images/small_gray_warning.png); }
.alert-question {background-image:url(https://cdn.rawgit.com/hplgit/doconce/master/bundled/html_images/small_gray_question.png); }

div { text-align: justify; text-justify: inter-word; }

    </style>


</head>

<!-- tocinfo
{'highest level': 1,
 'sections': [('Web frameworks', 1, None, '___sec0'),
              ('Other frameworks', 3, None, '___sec1'),
              ('The MVC pattern', 2, None, '___sec2'),
              ('A very simple application', 2, None, '___sec3'),
              ('Application of the MVC pattern', 2, 'wf:hw:mvc', 'wf:hw:mvc'),
              ('Making a Flask application', 1, None, '___sec5'),
              ('Programming the Flask application', 2, None, '___sec6'),
              ('The user interaction', 3, None, '___sec7'),
              ('The Python code', 3, None, '___sec8'),
              ('Dissection', 3, None, '___sec9'),
              ('The template files', 3, None, '___sec10'),
              ('Testing the application', 3, None, '___sec11'),
              ('Equipping the input page with output results',
               2,
               None,
               '___sec12'),
              ('Splitting the app into model, view, and controller files',
               2,
               'wf:hw3:flask',
               'wf:hw3:flask'),
              ('Troubleshooting', 2, None, '___sec14'),
              ('Address already in use', 3, None, '___sec15'),
              ('Making a Django application', 1, None, '___sec16'),
              ('Setting up a Django project', 2, None, '___sec17'),
              ('Setting up a Django application', 2, None, '___sec18'),
              ('Programming the Django application', 2, None, '___sec19'),
              ('The user interaction', 3, None, '___sec20'),
              ('The model', 3, None, '___sec21'),
              ('The view', 3, None, '___sec22'),
              ('Making the input page', 3, None, '___sec23'),
              ('Making the results page', 3, None, '___sec24'),
              ('Equipping the input page with output results',
               2,
               None,
               '___sec25'),
              ('Handling multiple input variables in Flask',
               1,
               'wf:vib:flask',
               'wf:vib:flask'),
              ('Programming the Flask application',
               2,
               'wf:vib1:flask:app',
               'wf:vib1:flask:app'),
              ('The compute part', 3, None, '___sec28'),
              ('The model', 3, None, '___sec29'),
              ('The view', 3, None, '___sec30'),
              ('The HTML template', 3, None, '___sec31'),
              ('Implementing error checking in the template',
               2,
               None,
               '___sec32'),
              ('Using style sheets', 2, None, '___sec33'),
              ('Using LaTeX mathematics', 2, None, '___sec34'),
              ('Rearranging the elements in the HTML template',
               2,
               None,
               '___sec35'),
              ('Bootstrap HTML style', 2, None, '___sec36'),
              ('Custom validation',
               2,
               'wf:vib1:flask:validation',
               'wf:vib1:flask:validation'),
              ('Using Flask validators', 3, None, '___sec38'),
              ('Tailored validation', 3, None, '___sec39'),
              ('Tailored validation of intervals', 3, None, '___sec40'),
              ('Demo', 3, None, '___sec41'),
              ('Avoiding plot files',
               2,
               'wf:vib2:flask:nofiles',
               'wf:vib2:flask:nofiles'),
              ('PNG plots', 3, None, '___sec43'),
              ('SVG plots', 3, None, '___sec44'),
              ('Using mpld3', 3, None, '___sec45'),
              ('Plotting with the Bokeh library',
               2,
               'wf:bokeh:flask',
               'wf:bokeh:flask'),
              ('Pandas highcharts plotting library', 3, None, '___sec47'),
              ('Autogenerating the code',
               2,
               'wf:autogen:flask',
               'wf:autogen:flask'),
              ('Inspecting function signatures', 3, None, '___sec49'),
              ('Generating the model', 3, None, '___sec50'),
              ('Generating the view', 3, None, '___sec51'),
              ('Generating the template', 3, None, '___sec52'),
              ('Application', 3, None, '___sec53'),
              ('User login and storage of computed results',
               2,
               'wf:flask:login',
               'wf:flask:login'),
              ('Required additional software', 3, None, '___sec55'),
              ('The compute part', 3, None, '___sec56'),
              ('The interfaces of the app', 3, None, '___sec57'),
              ('The source code', 3, None, '___sec58'),
              ('Resources', 3, None, '___sec59'),
              ('Uploading of files', 2, 'wf:flask:upload', 'wf:flask:upload'),
              ('Overview of the application', 3, None, '___sec61'),
              ('The model class', 3, None, '___sec62'),
              ('The controller file', 3, None, '___sec63'),
              ('The compute function', 3, None, '___sec64'),
              ('The HTML template', 3, None, '___sec65'),
              ('Handling multiple input variables in Django',
               1,
               'wf:vib:django',
               'wf:vib:django'),
              ('Programming the Django application', 2, None, '___sec67'),
              ('Adding the app to a project', 3, None, '___sec68'),
              ('The compute part', 3, None, '___sec69'),
              ('The model', 3, None, '___sec70'),
              ('The view', 3, None, '___sec71'),
              ('Custom validation', 2, None, '___sec72'),
              ('Customizing widgets', 2, None, '___sec73'),
              ('Resources', 2, None, '___sec74'),
              ('Exercises', 1, None, '___sec75'),
              ('Exercise 1: Add two numbers',
               2,
               'wf:exer:add2',
               'wf:exer:add2'),
              ('Exercise 2: Upload data file and visualize curves',
               2,
               'wf:exer:upload',
               'wf:exer:upload'),
              ('Exercise 3: Plot a user-specified formula',
               2,
               'wf:exer:formula',
               'wf:exer:formula'),
              ('Exercise 4: Visualize Taylor polynomial approximations',
               2,
               'wf:exer:Taylor',
               'wf:exer:Taylor'),
              ('Exercise 5: Extend the `gen` app',
               2,
               'wf:exer:gen:demo',
               'wf:exer:gen:demo'),
              ('Exercise 6: Make a web app with multiple apps',
               2,
               'wf:exer:addmul',
               'wf:exer:addmul'),
              ('Exercise 7: Equip the `gen` app with more data types',
               2,
               'wf:exer:gen:lists',
               'wf:exer:gen:lists'),
              ('Exercise 8: Auto-generate code from function signature',
               2,
               None,
               '___sec83'),
              ('Project 9: Interactive function exploration',
               2,
               'wf:exer:bokeh_UI',
               'wf:exer:bokeh_UI'),
              ('Resources', 1, None, '___sec85'),
              ('Flask resources', 2, None, '___sec86'),
              ('Django resources', 2, None, '___sec87')]}
end of tocinfo -->

<body>


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "none"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js", "color.js"]
  }
});

</script>
<script type="text/javascript"
        src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<a name="part0004"></a>
<p>
    <!-- begin top navigation -->
<table style="width: 100%">
    <tr>
        <td>
            <div style="text-align: left;"><a href="._web4sa_plain003.html">&laquo; Previous</a></div>
        </td>
        <td>
            <div style="text-align: right;"><a href="._web4sa_plain005.html">Next &raquo;</a></div>
        </td>
    </tr>
</table>
<!-- end top navigation -->
</p>

<p>
    <!-- !split -->

<h1 id="___sec5">Making a Flask application </h1>

<p>
    Not much code or configuration is needed to make a Flask application.
    Actually one short file is enough. For this file to work you need to
    install Flask and some corresponding packages. This is easiest
    performed by

<p>

    <!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">Terminal&gt; sudo pip install --upgrade Flask
Terminal&gt; sudo pip install --upgrade Flask-WTF
</pre>
</div>
<p>
    The <code>--upgrade</code> option ensures that you upgrade to the latest version in
    case you already have these packages.

<h2 id="___sec6">Programming the Flask application </h2>

<h3 id="___sec7">The user interaction </h3>

<p>
    We want our input page to feature a text field where the user can
    write the value of <code>r</code>, see Figure <a href="#wf:hw1:flask:fig:input">1</a>.
    By clicking on the <em>equals</em> button
    the corresponding <code>s</code> value is computed and written out the result page
    seen in Figure <a href="#wf:hw1:flask:fig:result">2</a>.

<p>
    <center> <!-- figure -->
        <hr class="figure">
        <center>
<p class="caption">Figure 1: The input page.
<div id="wf:hw1:flask:fig:input"></div>
</p></center>
<p><img src="fig-web4sa/hw1_flask_input.png" align="bottom" width=600></p>
</center>

<p>
    <center> <!-- figure -->
        <hr class="figure">
        <center>
<p class="caption">Figure 2: The output page.
<div id="wf:hw1:flask:fig:result"></div>
</p></center>
<p><img src="fig-web4sa/hw1_flask_output.png" align="bottom" width=600></p>
</center>

<h3 id="___sec8">The Python code </h3>

<p>
    Flask does not require us to use the MVC pattern so there is actually
    no need to split the original program into model, view, controller,
    and compute files as already explained (but it will be
    done later). First we make a <code>controller.py</code> file where the view, the
    model, and the controller parts appear within the same file.
    The <code>compute</code> component is always in a separate file as
    we like to encapsulate the computations completely from user
    interfaces.

<p>
    The view that the user sees is determined by
    HTML templates in a subdirectory <code>templates</code>, and consequently
    we name the template files <code>view*.html</code>.
    The model and other parts of the view concept are just parts of
    the <code>controller.py</code> file. The complete file is short and explained
    in detail below.

<p>

    <!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span
        style="color: #008000; font-weight: bold">from</span> <span
        style="color: #0000FF; font-weight: bold">flask</span> <span
        style="color: #008000; font-weight: bold">import</span> Flask, render_template, request
<span style="color: #008000; font-weight: bold">from</span> <span
            style="color: #0000FF; font-weight: bold">wtforms</span> <span style="color: #008000; font-weight: bold">import</span> Form, FloatField, validators
<span style="color: #008000; font-weight: bold">from</span> <span
            style="color: #0000FF; font-weight: bold">compute</span> <span style="color: #008000; font-weight: bold">import</span> compute

app <span style="color: #666666">=</span> Flask(__name__)

<span style="color: #408080; font-style: italic"># Model</span>
<span style="color: #008000; font-weight: bold">class</span> <span
            style="color: #0000FF; font-weight: bold">InputForm</span>(Form):
    r <span style="color: #666666">=</span> FloatField(validators<span style="color: #666666">=</span>[validators<span
            style="color: #666666">.</span>InputRequired()])

<span style="color: #408080; font-style: italic"># View</span>
<span style="color: #AA22FF">@app.route</span>(<span style="color: #BA2121">&#39;/hw1&#39;</span>, methods<span
            style="color: #666666">=</span>[<span style="color: #BA2121">&#39;GET&#39;</span>, <span
            style="color: #BA2121">&#39;POST&#39;</span>])
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">index</span>():
    form <span style="color: #666666">=</span> InputForm(request<span style="color: #666666">.</span>form)
    <span style="color: #008000; font-weight: bold">if</span> request<span style="color: #666666">.</span>method <span
            style="color: #666666">==</span> <span style="color: #BA2121">&#39;POST&#39;</span> <span
            style="color: #AA22FF; font-weight: bold">and</span> form<span style="color: #666666">.</span>validate():
        r <span style="color: #666666">=</span> form<span style="color: #666666">.</span>r<span
            style="color: #666666">.</span>data
        s <span style="color: #666666">=</span> compute(r)
        <span style="color: #008000; font-weight: bold">return</span> render_template(<span style="color: #BA2121">&quot;view_output.html&quot;</span>, form<span
            style="color: #666666">=</span>form, s<span style="color: #666666">=</span>s)
    <span style="color: #008000; font-weight: bold">else</span>:
        <span style="color: #008000; font-weight: bold">return</span> render_template(<span style="color: #BA2121">&quot;view_input.html&quot;</span>, form<span
            style="color: #666666">=</span>form)

<span style="color: #008000; font-weight: bold">if</span> __name__ <span style="color: #666666">==</span> <span
            style="color: #BA2121">&#39;__main__&#39;</span>:
    app<span style="color: #666666">.</span>run(debug<span style="color: #666666">=</span><span style="color: #008000">True</span>)
</pre>
</div>

<h3 id="___sec9">Dissection </h3>

<p>
    The web application is the <code>app</code> object of class <code>Flask</code>, and
    initialized as shown. The model is a special Flask class derived from
    <code>Form</code> where the input variable in the app is listed as a static class
    attribute and initialized by a special form field object from the
    <code>wtforms</code> package. Such form field objects correspond to HTML forms
    in the input page. For the <code>r</code> variable we apply <code>FloatField</code> since
    it is a floating-point variable. A default validator, here checking
    that the user supplies a real number, is automatically included, but
    we add another validator, <code>InputRequired</code>, to force the user to
    provide input before clicking on the <em>equals</em> button.

<p>
    The view part of this Python code consists of a URL and a
    corresponding function to call when the URL is invoked. The function
    name is here chosen to be <code>index</code> (inspired by the standard
    <code>index.html</code> page that is the main page of a web app). The decorator
    <code>@app.route('/hw1', ...)</code> maps the URL <code>http://127.0.0.1:5000/hw1</code> to
    a call to <code>index</code>. The <code>methods</code> argument must be as shown to allow
    the user to communicate with the web page.

<p>
    The <code>index</code> function first makes a form object based on the data in
    the model, here class <code>InputForm</code>. Then there are two possibilities:
    either the user has provided data in the HTML form or the user is
    to be offered an input form. In the former case, <code>request.method</code>
    equals <code>'POST'</code> and we can extract the numerical value of <code>r</code>
    from the <code>form</code> object, using <code>form.r.data</code>, call up our mathematical
    computations, and make a web page with the result.
    In the latter case, we make an input page as displayed in
    Figure <a href="#wf:hw1:flask:fig:input">1</a>.

<h3 id="___sec10">The template files </h3>

<p>
    Making a web page with Flask is conveniently done by an HTML
    template. Since the output page is simplest we display the
    <code>view_output.html</code> template first:

<p>

    <!-- code=html (!bc htmlpro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">Hello, World! sin({{ form.r.data }})={{s}}.
</pre>
</div>
<p>
    Keyword arguments sent to <code>render_template</code> are available in the
    HTML template. Here we have the keyword arguments <code>form</code> and <code>s</code>.
    With the <code>form</code> object we extract the value of
    <code>r</code> in the HTML code by <code>{{ form.r.data }}</code>. Similarly, the value of <code>s</code>
    is simply <code>{{ s }}</code>.

<p>
    The HTML template for the input page is slightly more complicated
    as we need to use an HTML form:

<p>

    <!-- code=html (!bc htmlpro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span
        style="color: #008000; font-weight: bold">&lt;form</span> <span style="color: #7D9029">method=</span><span
        style="color: #BA2121">post</span> <span style="color: #7D9029">action=</span><span style="color: #BA2121">&quot;&quot;</span><span
        style="color: #008000; font-weight: bold">&gt;</span>
  Hello, World! The sine of {{ form.r }}
  <span style="color: #008000; font-weight: bold">&lt;input</span> <span style="color: #7D9029">type=</span><span
            style="color: #BA2121">submit</span> <span style="color: #7D9029">value=</span><span style="color: #BA2121">equals</span><span
            style="color: #008000; font-weight: bold">&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;/form&gt;</span>
</pre>
</div>

<h3 id="___sec11">Testing the application </h3>

<p>
    We collect the files associated with a Flask application (often called
    just <em>app</em>) in a directory,
    here called <a
        href="https://github.com/hplgit/web4sciapps/tree/master/doc/src/web4sa/src-web4sa/apps/flask_apps/hw1"
        target="_self"><tt>hw1</tt></a>.
    All you have to do in order to run this web application is to find
    this directory and run

<p>

    <!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">Terminal&gt; python controller.py
 * Running on http://127.0.0.1:5000/
 * Restarting with reloader
</pre>
</div>
<p>
    Open a new window or tab in your browser and type in the URL
    <code>http://127.0.0.1:5000/hw1</code>.

<h2 id="___sec12">Equipping the input page with output results </h2>

<p>
    Our application made two distinct pages for grabbing input from the
    user and presenting the result. It is often more natural to add
    the result to the input page. This is particularly the case in the present
    web application, which is a kind of calculator. Figure <a href="#wf:hw2:flask:fig:result">3</a> shows what the user
    sees after clicking the <em>equals</em> button.

<p>
    <center> <!-- figure -->
        <hr class="figure">
        <center>
<p class="caption">Figure 3: The modified result page.
<div id="wf:hw2:flask:fig:result"></div>
</p></center>
<p><img src="fig-web4sa/hw2_flask_output.png" align="bottom" width=600></p>
</center>

<p>
    To let the user stay within the same page, we create a new directory
    <a href="https://github.com/hplgit/web4sciapps/tree/master/doc/src/web4sa/src-web4sa/apps/flask_apps/hw2"
       target="_self"><tt>hw2</tt></a>
    for this modified Flask app and copy the files from the previous
    <code>hw1</code> directory. The idea now is to make use of just one
    template, in <code>templates/view.html</code>:

<p>

    <!-- code=html (!bc htmlpro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span
        style="color: #008000; font-weight: bold">&lt;form</span> <span style="color: #7D9029">method=</span><span
        style="color: #BA2121">post</span> <span style="color: #7D9029">action=</span><span style="color: #BA2121">&quot;&quot;</span><span
        style="color: #008000; font-weight: bold">&gt;</span>
  Hello, World! The sine of
  {{( form.r )}}
  <span style="color: #008000; font-weight: bold">&lt;input</span> <span style="color: #7D9029">type=</span><span
            style="color: #BA2121">submit</span> <span style="color: #7D9029">value=</span><span style="color: #BA2121">equals</span><span
            style="color: #008000; font-weight: bold">&gt;</span>
{% if s != None %}
{{s}}
{% endif %}
<span style="color: #008000; font-weight: bold">&lt;/form&gt;</span>
</pre>
</div>
<p>
    The form is identical to what we used in <code>view_input.html</code> in
    the <code>hw1</code> directory, and the only
    new thing is the output of <code>s</code> below the form.

<p>
    The template language supports some programming with Python objects
    inside <code>{%</code> and <code>%}</code> tags.
    Specifically in this file, we can test on the value of <code>s</code>:
    if it is <code>None</code>, we know that the computations are not performed and
    <code>s</code> should not appear on the page, otherwise <code>s</code> holds the sine
    value and we can write it out. Note that, contrary to plain Python,
    the template language does not rely on indentation of blocks and
    therefore needs an explicit end statement <code>{% endif %}</code> to finish
    the if-test.
    The generated HTML code from this template file reads

<p>

    <!-- code=html (!bc htmlpro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span
        style="color: #008000; font-weight: bold">&lt;form</span> <span style="color: #7D9029">method=</span><span
        style="color: #BA2121">post</span> <span style="color: #7D9029">action=</span><span style="color: #BA2121">&quot;&quot;</span><span
        style="color: #008000; font-weight: bold">&gt;</span>
  Hello, World! The sine of
  <span style="color: #008000; font-weight: bold">&lt;input</span> <span style="color: #7D9029">id=</span><span
            style="color: #BA2121">&quot;r&quot;</span> <span style="color: #7D9029">name=</span><span
            style="color: #BA2121">&quot;r&quot;</span> <span style="color: #7D9029">type=</span><span
            style="color: #BA2121">&quot;text&quot;</span> <span style="color: #7D9029">value=</span><span
            style="color: #BA2121">&quot;1.2&quot;</span><span style="color: #008000; font-weight: bold">&gt;</span>
  <span style="color: #008000; font-weight: bold">&lt;input</span> <span style="color: #7D9029">type=</span><span
            style="color: #BA2121">submit</span> <span style="color: #7D9029">value=</span><span style="color: #BA2121">equals</span><span
            style="color: #008000; font-weight: bold">&gt;</span>

0.932039085967

<span style="color: #008000; font-weight: bold">&lt;/form&gt;</span>
</pre>
</div>
<p>
    The <code>index</code> function of our modified application
    needs adjustments since we use the same
    template for the input and the output page:

<p>

    <!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span
        style="color: #408080; font-style: italic"># View</span>
<span style="color: #AA22FF">@app.route</span>(<span style="color: #BA2121">&#39;/hw2&#39;</span>, methods<span
            style="color: #666666">=</span>[<span style="color: #BA2121">&#39;GET&#39;</span>, <span
            style="color: #BA2121">&#39;POST&#39;</span>])
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">index</span>():
    form <span style="color: #666666">=</span> InputForm(request<span style="color: #666666">.</span>form)
    <span style="color: #008000; font-weight: bold">if</span> request<span style="color: #666666">.</span>method <span
            style="color: #666666">==</span> <span style="color: #BA2121">&#39;POST&#39;</span> <span
            style="color: #AA22FF; font-weight: bold">and</span> form<span style="color: #666666">.</span>validate():
        r <span style="color: #666666">=</span> form<span style="color: #666666">.</span>r<span
            style="color: #666666">.</span>data
        s <span style="color: #666666">=</span> compute(r)
    <span style="color: #008000; font-weight: bold">else</span>:
        s <span style="color: #666666">=</span> <span style="color: #008000">None</span>

    <span style="color: #008000; font-weight: bold">return</span> render_template(<span style="color: #BA2121">&quot;view.html&quot;</span>, form<span
            style="color: #666666">=</span>form, s<span style="color: #666666">=</span>s)
</pre>
</div>
<p>
    It is seen that if the user has given data, <code>s</code> is a <code>float</code>, otherwise
    <code>s</code> is <code>None</code>. You are encouraged to test the app by running

<p>

    <!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">Terminal&gt; python controller.py
</pre>
</div>
<p>
    and loading <code>http://127.0.0.1:5000/hw2</code> into your browser.
    A nice little exercise is to control the formatting of the result <code>s</code>.
    To this end, you can simply transform <code>s</code> to a string: <code>s = '%.5f' % s</code> before
    sending it to <code>render_template</code>.

<h2 id="wf:hw3:flask">Splitting the app into model, view, and controller files</h2>

<p>
    In our previous two Flask apps we have had the view displayed for the
    user in a separate template file, and the computations as always in
    <code>compute.py</code>, but everything else was placed in one file <code>controller.py</code>.
    For illustration of the MVC concept we
    may split the <code>controller.py</code> into two files: <code>model.py</code> and
    <code>controller.py</code>. The view is in <code>templates/view.html</code>.
    These new files are located in a
    directory
    <a href="https://github.com/hplgit/web4sciapps/tree/master/doc/src/web4sa/src-web4sa/apps/flask_apps/hw3"
       target="_self"><tt>hw3_flask</tt></a>
    The contents
    in the files reflect the splitting introduced in the original
    scientific hello world program in the section <a href="._web4sa_plain003.html#wf:hw:mvc">Application of the MVC
    pattern</a>.
    The <code>model.py</code> file now consists of the input form class:

<p>

    <!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span
        style="color: #008000; font-weight: bold">from</span> <span
        style="color: #0000FF; font-weight: bold">wtforms</span> <span
        style="color: #008000; font-weight: bold">import</span> Form, FloatField, validators

<span style="color: #008000; font-weight: bold">class</span> <span
            style="color: #0000FF; font-weight: bold">InputForm</span>(Form):
    r <span style="color: #666666">=</span> FloatField(validators<span style="color: #666666">=</span>[validators<span
            style="color: #666666">.</span>InputRequired()])
</pre>
</div>
<p>
    The file <code>templates/view.html</code> is as before, while <code>controller.py</code> contains

<p>

    <!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span
        style="color: #008000; font-weight: bold">from</span> <span
        style="color: #0000FF; font-weight: bold">flask</span> <span
        style="color: #008000; font-weight: bold">import</span> Flask, render_template, request
<span style="color: #008000; font-weight: bold">from</span> <span
            style="color: #0000FF; font-weight: bold">compute</span> <span style="color: #008000; font-weight: bold">import</span> compute
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">model</span> <span
            style="color: #008000; font-weight: bold">import</span> InputForm
    
app <span style="color: #666666">=</span> Flask(__name__)

<span style="color: #AA22FF">@app.route</span>(<span style="color: #BA2121">&#39;/hw3&#39;</span>, methods<span
            style="color: #666666">=</span>[<span style="color: #BA2121">&#39;GET&#39;</span>, <span
            style="color: #BA2121">&#39;POST&#39;</span>])
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">index</span>():
    form <span style="color: #666666">=</span> InputForm(request<span style="color: #666666">.</span>form)
    <span style="color: #008000; font-weight: bold">if</span> request<span style="color: #666666">.</span>method <span
            style="color: #666666">==</span> <span style="color: #BA2121">&#39;POST&#39;</span> <span
            style="color: #AA22FF; font-weight: bold">and</span> form<span style="color: #666666">.</span>validate():
        r <span style="color: #666666">=</span> form<span style="color: #666666">.</span>r<span
            style="color: #666666">.</span>data
        s <span style="color: #666666">=</span> compute(r)
    <span style="color: #008000; font-weight: bold">else</span>:
        s <span style="color: #666666">=</span> <span style="color: #008000">None</span>

    <span style="color: #008000; font-weight: bold">return</span> render_template(<span style="color: #BA2121">&quot;view.html&quot;</span>, form<span
            style="color: #666666">=</span>form, s<span style="color: #666666">=</span>s)


<span style="color: #008000; font-weight: bold">if</span> __name__ <span style="color: #666666">==</span> <span
            style="color: #BA2121">&#39;__main__&#39;</span>:
    app<span style="color: #666666">.</span>run(debug<span style="color: #666666">=</span><span style="color: #008000">True</span>)
</pre>
</div>
<p>
    The statements are indentical to those in the <code>hw2</code> app, only
    the organization of the statement in files differ.

<p>
<p>
    <!-- begin bottom navigation -->
<table style="width: 100%">
    <tr>
        <td>
            <div style="text-align: left;"><a href="._web4sa_plain003.html">&laquo; Previous</a></div>
        </td>
        <td>
            <div style="text-align: right;"><a href="._web4sa_plain005.html">Next &raquo;</a></div>
        </td>
    </tr>
</table>
<!-- end bottom navigation -->
</p>

<!-- ------------------- end of main content --------------- -->


<center style="font-size:80%">
    <!-- copyright only on the titlepage -->
</center>


</body>
</html>
    

