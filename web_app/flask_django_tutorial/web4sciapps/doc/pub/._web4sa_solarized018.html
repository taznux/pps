<!--
Automatically generated HTML file from DocOnce source
(https://github.com/hplgit/doconce/)
-->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="generator" content="DocOnce: https://github.com/hplgit/doconce/"/>
    <meta name="description" content="Using Web Frameworks for Scientific Applications">
    <meta name="keywords"
          content="web frameworks,MVC pattern,Flask installation,Flask input forms,Flask HTML templates,Flask MVC pattern,Flask troubleshooting,Django installation,Django making a project,Django making an application,Django input forms,Django HTML templates,Flask input forms,Flask error checking,Flask CSS style sheets,Flask LaTeX mathematics,Flask input validation,inline PNG image in HTML,base64 encoding of PNG images,inline SVG figure in HTML,mpld3 plotting,Flask Bokeh plotting,Bokeh plotting,highcharts,Flask login,Flask database,Flask uploading of files,Flask file upload,Django input forms,Django input validation">

    <title>Using Web Frameworks for Scientific Applications</title>


    <link href="https://cdn.rawgit.com/hplgit/doconce/master/bundled/html_styles/style_solarized_box/css/solarized_light_code.css"
          rel="stylesheet" type="text/css" title="light"/>
    <script src="https://cdn.rawgit.com/hplgit/doconce/master/bundled/html_styles/style_solarized_box/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <link href="http://thomasf.github.io/solarized-css/solarized-light.min.css" rel="stylesheet">
    <style type="text/css">
h1 {color: #b58900;}  /* yellow */
/* h1 {color: #cb4b16;}  orange */
/* h1 {color: #d33682;}  magenta, the original choice of thomasf */
code { padding: 0px; background-color: inherit; }
pre {
  border: 0pt solid #93a1a1;
  box-shadow: none;
}
.alert-text-small   { font-size: 80%;  }
.alert-text-large   { font-size: 130%; }
.alert-text-normal  { font-size: 90%;  }
.alert {
  padding:8px 35px 8px 14px; margin-bottom:18px;
  text-shadow:0 1px 0 rgba(255,255,255,0.5);
  border:1px solid #93a1a1;
  border-radius: 4px;
  -webkit-border-radius: 4px;
  -moz-border-radius: 4px;
  color: #555;
  background-color: #eee8d5;
  background-position: 10px 5px;
  background-repeat: no-repeat;
  background-size: 38px;
  padding-left: 55px;
  width: 75%;
 }
.alert-block {padding-top:14px; padding-bottom:14px}
.alert-block > p, .alert-block > ul {margin-bottom:1em}
.alert li {margin-top: 1em}
.alert-block p+p {margin-top:5px}
.alert-notice { background-image: url(https://cdn.rawgit.com/hplgit/doconce/master/bundled/html_images/small_yellow_notice.png); }
.alert-summary  { background-image:url(https://cdn.rawgit.com/hplgit/doconce/master/bundled/html_images/small_yellow_summary.png); }
.alert-warning { background-image: url(https://cdn.rawgit.com/hplgit/doconce/master/bundled/html_images/small_yellow_warning.png); }
.alert-question {background-image:url(https://cdn.rawgit.com/hplgit/doconce/master/bundled/html_images/small_yellow_question.png); }

div { text-align: justify; text-justify: inter-word; }

    </style>


</head>

<!-- tocinfo
{'highest level': 1,
 'sections': [('Web frameworks', 1, None, '___sec0'),
              ('Other frameworks', 3, None, '___sec1'),
              ('The MVC pattern', 2, None, '___sec2'),
              ('A very simple application', 2, None, '___sec3'),
              ('Application of the MVC pattern', 2, 'wf:hw:mvc', 'wf:hw:mvc'),
              ('Making a Flask application', 1, None, '___sec5'),
              ('Programming the Flask application', 2, None, '___sec6'),
              ('The user interaction', 3, None, '___sec7'),
              ('The Python code', 3, None, '___sec8'),
              ('Dissection', 3, None, '___sec9'),
              ('The template files', 3, None, '___sec10'),
              ('Testing the application', 3, None, '___sec11'),
              ('Equipping the input page with output results',
               2,
               None,
               '___sec12'),
              ('Splitting the app into model, view, and controller files',
               2,
               'wf:hw3:flask',
               'wf:hw3:flask'),
              ('Troubleshooting', 2, None, '___sec14'),
              ('Address already in use', 3, None, '___sec15'),
              ('Making a Django application', 1, None, '___sec16'),
              ('Setting up a Django project', 2, None, '___sec17'),
              ('Setting up a Django application', 2, None, '___sec18'),
              ('Programming the Django application', 2, None, '___sec19'),
              ('The user interaction', 3, None, '___sec20'),
              ('The model', 3, None, '___sec21'),
              ('The view', 3, None, '___sec22'),
              ('Making the input page', 3, None, '___sec23'),
              ('Making the results page', 3, None, '___sec24'),
              ('Equipping the input page with output results',
               2,
               None,
               '___sec25'),
              ('Handling multiple input variables in Flask',
               1,
               'wf:vib:flask',
               'wf:vib:flask'),
              ('Programming the Flask application',
               2,
               'wf:vib1:flask:app',
               'wf:vib1:flask:app'),
              ('The compute part', 3, None, '___sec28'),
              ('The model', 3, None, '___sec29'),
              ('The view', 3, None, '___sec30'),
              ('The HTML template', 3, None, '___sec31'),
              ('Implementing error checking in the template',
               2,
               None,
               '___sec32'),
              ('Using style sheets', 2, None, '___sec33'),
              ('Using LaTeX mathematics', 2, None, '___sec34'),
              ('Rearranging the elements in the HTML template',
               2,
               None,
               '___sec35'),
              ('Bootstrap HTML style', 2, None, '___sec36'),
              ('Custom validation',
               2,
               'wf:vib1:flask:validation',
               'wf:vib1:flask:validation'),
              ('Using Flask validators', 3, None, '___sec38'),
              ('Tailored validation', 3, None, '___sec39'),
              ('Tailored validation of intervals', 3, None, '___sec40'),
              ('Demo', 3, None, '___sec41'),
              ('Avoiding plot files',
               2,
               'wf:vib2:flask:nofiles',
               'wf:vib2:flask:nofiles'),
              ('PNG plots', 3, None, '___sec43'),
              ('SVG plots', 3, None, '___sec44'),
              ('Using mpld3', 3, None, '___sec45'),
              ('Plotting with the Bokeh library',
               2,
               'wf:bokeh:flask',
               'wf:bokeh:flask'),
              ('Pandas highcharts plotting library', 3, None, '___sec47'),
              ('Autogenerating the code',
               2,
               'wf:autogen:flask',
               'wf:autogen:flask'),
              ('Inspecting function signatures', 3, None, '___sec49'),
              ('Generating the model', 3, None, '___sec50'),
              ('Generating the view', 3, None, '___sec51'),
              ('Generating the template', 3, None, '___sec52'),
              ('Application', 3, None, '___sec53'),
              ('User login and storage of computed results',
               2,
               'wf:flask:login',
               'wf:flask:login'),
              ('Required additional software', 3, None, '___sec55'),
              ('The compute part', 3, None, '___sec56'),
              ('The interfaces of the app', 3, None, '___sec57'),
              ('The source code', 3, None, '___sec58'),
              ('Resources', 3, None, '___sec59'),
              ('Uploading of files', 2, 'wf:flask:upload', 'wf:flask:upload'),
              ('Overview of the application', 3, None, '___sec61'),
              ('The model class', 3, None, '___sec62'),
              ('The controller file', 3, None, '___sec63'),
              ('The compute function', 3, None, '___sec64'),
              ('The HTML template', 3, None, '___sec65'),
              ('Handling multiple input variables in Django',
               1,
               'wf:vib:django',
               'wf:vib:django'),
              ('Programming the Django application', 2, None, '___sec67'),
              ('Adding the app to a project', 3, None, '___sec68'),
              ('The compute part', 3, None, '___sec69'),
              ('The model', 3, None, '___sec70'),
              ('The view', 3, None, '___sec71'),
              ('Custom validation', 2, None, '___sec72'),
              ('Customizing widgets', 2, None, '___sec73'),
              ('Resources', 2, None, '___sec74'),
              ('Exercises', 1, None, '___sec75'),
              ('Exercise 1: Add two numbers',
               2,
               'wf:exer:add2',
               'wf:exer:add2'),
              ('Exercise 2: Upload data file and visualize curves',
               2,
               'wf:exer:upload',
               'wf:exer:upload'),
              ('Exercise 3: Plot a user-specified formula',
               2,
               'wf:exer:formula',
               'wf:exer:formula'),
              ('Exercise 4: Visualize Taylor polynomial approximations',
               2,
               'wf:exer:Taylor',
               'wf:exer:Taylor'),
              ('Exercise 5: Extend the `gen` app',
               2,
               'wf:exer:gen:demo',
               'wf:exer:gen:demo'),
              ('Exercise 6: Make a web app with multiple apps',
               2,
               'wf:exer:addmul',
               'wf:exer:addmul'),
              ('Exercise 7: Equip the `gen` app with more data types',
               2,
               'wf:exer:gen:lists',
               'wf:exer:gen:lists'),
              ('Exercise 8: Auto-generate code from function signature',
               2,
               None,
               '___sec83'),
              ('Project 9: Interactive function exploration',
               2,
               'wf:exer:bokeh_UI',
               'wf:exer:bokeh_UI'),
              ('Resources', 1, None, '___sec85'),
              ('Flask resources', 2, None, '___sec86'),
              ('Django resources', 2, None, '___sec87')]}
end of tocinfo -->

<body>


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "none"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js", "color.js"]
  }
});

</script>
<script type="text/javascript"
        src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<a name="part0018"></a>
<p>
    <!-- begin top navigation -->
<table style="width: 100%">
    <tr>
        <td>
            <div style="text-align: left;"><a href="._web4sa_solarized017.html">&laquo; Previous</a></div>
        </td>
        <td>
            <div style="text-align: right;"><a href="._web4sa_solarized019.html">Next &raquo;</a></div>
        </td>
    </tr>
</table>
<!-- end top navigation -->
</p>

<p>
    <!-- !split -->

<h2 id="wf:flask:upload">Uploading of files</h2>

<h3 id="___sec61">Overview of the application </h3>

<p>
    Many user interfaces need the user to provide data files. A minimalistic
    application is to have a button for uploading a single file.
    As example we use a file with a series of numbers, and the application's
    purpose is to compute the mean and standard deviation of the numbers.
    The first user interface just has the <em>Choose File</em> and <em>Compute</em> buttons:

<p>
    <center>
<p><img src="fig-web4sa/upload1.png" align="bottom" width=550></p></center>

<p>
    Clicking on <em>Choose File</em> brings up a file browser where the user can
    choose the file to uploaded to the application. Say this is a file
    <code>testfile.dat</code>. The interface now looks like

<p>
    <center>
<p><img src="fig-web4sa/upload2.png" align="bottom" width=550></p></center>

<p>
    Pressing thereafter <em>Compute</em> leads to storage of
    <code>testfile.dat</code> on the server in a subdirectory <code>uploads</code> and
    computation of basic statistics of the numbers in the file.
    The resulting output looks like

<p>
    <center>
<p><img src="fig-web4sa/upload3.png" align="bottom" width=550></p></center>

<p>
    The text &quot;No file chosen&quot; is automatically displayed by the
    widget object used for file upload and indicates that a new
    file can be chosen. Below we shall present all parts of the code
    needed to create this interactive application.

<h3 id="___sec62">The model class </h3>

<p>
    The widget <code>FieldField</code> is used for an input field with a <em>Choose File</em>
    button:

<p>
    <!-- begin verbatim block  pypro-->
<pre><code>import wtforms as wtf

class Average(wtf.Form):
    filename   = wtf.FileField(validators=
                               [wtf.validators.InputRequired()])
</code></pre>
<!-- end verbatim block -->

<h3 id="___sec63">The controller file </h3>

<p>
    The controller file needs some special code to specify a directory
    to store uploaded files. We also include some code to check that
    the file has a name with the right extension.

<p>
    <!-- begin verbatim block  pycod-->
<pre><code># Relative path of directory for uploaded files
UPLOAD_DIR = 'uploads/'

app.config['UPLOAD_FOLDER'] = UPLOAD_DIR
app.secret_key = 'MySecretKey'

if not os.path.isdir(UPLOAD_DIR):
    os.mkdir(UPLOAD_DIR)

# Allowed file types for file upload
ALLOWED_EXTENSIONS = set(['txt', 'dat', 'npy'])

def allowed_file(filename):
    &quot;&quot;&quot;Does filename have the right extension?&quot;&quot;&quot;
    return '.' in filename and \ 
           filename.rsplit('.', 1)[1] in ALLOWED_EXTENSIONS
</code></pre>
<!-- end verbatim block -->

<p>
    The <code>index</code> function must have code for saving the file, and as usual,
    calling the compute function and rendering a new page:

<p>
    <!-- begin verbatim block  pycod-->
<pre><code>def index():
    form = Average(request.form)
    filename = None  # default
    if request.method == 'POST':

        # Save uploaded file on server if it exists and is valid
        if request.files:
            file = request.files[form.filename.name]
            if file and allowed_file(file.filename):
                # Make a valid version of filename for any file ystem
                filename = secure_filename(file.filename)
                file.save(os.path.join(app.config['UPLOAD_FOLDER'],
                                       filename))

        result = compute_function(filename)
    else:
        result = None

    return render_template(&quot;view.html&quot;, form=form, result=result)
</code></pre>
<!-- end verbatim block -->

<h3 id="___sec64">The compute function </h3>

<p>
    We assume that the uploaded file is available in the <code>uploads</code>
    subdirectory, so the compute function needs to open this file, read
    the numbers, and compute statistics. The file reading and computations
    are easily done by <code>numpy</code> functions. The results are presented in
    an HTML table.

<p>
    <!-- begin verbatim block  pypro-->
<pre><code>import numpy as np
import os

def compute_mean_std(filename=None):
    data = np.loadtxt(os.path.join('uploads', filename))
    return &quot;&quot;&quot;
Data from file &lt;tt&gt;%s&lt;/tt&gt;:
&lt;p&gt;
&lt;table border=1&gt;
&lt;tr&gt;&lt;td&gt; mean    &lt;/td&gt;&lt;td&gt; %.3g &lt;/td&gt;&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt; st.dev. &lt;/td&gt;&lt;td&gt; %.3g &lt;/td&gt;&lt;/tr&gt;
&quot;&quot;&quot; % (filename, np.mean(data), np.std(data))
</code></pre>
<!-- end verbatim block -->

<h3 id="___sec65">The HTML template </h3>

<p>
    Although the present minimalistic application only needs a very simple
    HTML template, we reuse a quite generic template known from previous examples,
    where the input variables are listed to the left and the output of the
    compute function is presented to the right. Such a template looks like

<p>
    <!-- begin verbatim block  htmlpro-->
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot; /&gt;
    &lt;title&gt;Flask Average app&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;

  &lt;!-- Input and Results are typeset as a two-column table --&gt;
  &lt;table&gt;
  &lt;tr&gt;
  &lt;td valign=&quot;top&quot;&gt;
    &lt;h2&gt;Input:&lt;/h2&gt;

      &lt;form method=post action=&quot;&quot; enctype=&quot;multipart/form-data&quot;&gt;
        &lt;table&gt;
          {% for field in form %}
            &lt;tr&gt;&lt;td&gt;{{ field.name }}&lt;/td&gt;
                &lt;td&gt;{{ field(size=20) }}&lt;/td&gt;
                &lt;td&gt;{% if field.errors %}
                  &lt;ul class=errors&gt;
                  {% for error in field.errors %}
                    &lt;li&gt;{{ error }}&lt;/li&gt;
                  {% endfor %}&lt;/ul&gt;
                {% endif %}&lt;/td&gt;&lt;/tr&gt;
          {% endfor %}
        &lt;/table&gt;
        &lt;p&gt;&lt;input type=&quot;submit&quot; value=&quot;Compute&quot;&gt;
    &lt;/form&gt;&lt;/p&gt;
  &lt;/td&gt;

  &lt;td valign=&quot;top&quot;&gt;
    {% if result != None %}
      &lt;h2&gt;Results:&lt;/h2&gt;
        {{ result|safe }}

    {% endif %}
  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;/table&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<!-- end verbatim block -->

<p>
    The complete set of files is found in the <a
        href="https://github.com/hplgit/web4sciapps/tree/master/doc/src/web4sa/src-web4sa/apps/flask_apps/upload"
        target="_self"><tt>upload</tt></a> directory.

<p>
<p>
    <!-- begin bottom navigation -->
<table style="width: 100%">
    <tr>
        <td>
            <div style="text-align: left;"><a href="._web4sa_solarized017.html">&laquo; Previous</a></div>
        </td>
        <td>
            <div style="text-align: right;"><a href="._web4sa_solarized019.html">Next &raquo;</a></div>
        </td>
    </tr>
</table>
<!-- end bottom navigation -->
</p>

<!-- ------------------- end of main content --------------- -->


<center style="font-size:80%">
    <!-- copyright only on the titlepage -->
</center>


</body>
</html>
    

