<!--
Automatically generated HTML file from DocOnce source
(https://github.com/hplgit/doconce/)
-->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="generator" content="DocOnce: https://github.com/hplgit/doconce/"/>
    <meta name="description" content="Using Web Frameworks for Scientific Applications">
    <meta name="keywords"
          content="web frameworks,MVC pattern,Flask installation,Flask input forms,Flask HTML templates,Flask MVC pattern,Flask troubleshooting,Django installation,Django making a project,Django making an application,Django input forms,Django HTML templates,Flask input forms,Flask error checking,Flask CSS style sheets,Flask LaTeX mathematics,Flask input validation,inline PNG image in HTML,base64 encoding of PNG images,inline SVG figure in HTML,mpld3 plotting,Flask Bokeh plotting,Bokeh plotting,highcharts,Flask login,Flask database,Flask uploading of files,Flask file upload,Django input forms,Django input validation">

    <title>Using Web Frameworks for Scientific Applications</title>


    <style type="text/css">
/* bloodish style */

body {
  font-family: Helvetica, Verdana, Arial, Sans-serif;
  color: #404040;
  background: #ffffff;
}
h1 { font-size: 1.8em;  color: #8A0808; }
h2 { font-size: 1.6em;  color: #8A0808; }
h3 { font-size: 1.4em;  color: #8A0808; }
h4 { color: #8A0808; }
a { color: #8A0808; text-decoration:none; }
tt { font-family: "Courier New", Courier; }
/* pre style removed because it will interfer with pygments */
p { text-indent: 0px; }
hr { border: 0; width: 80%; border-bottom: 1px solid #aaa}
p.caption { width: 80%; font-style: normal; text-align: left; }
hr.figure { border: 0; width: 80%; border-bottom: 1px solid #aaa}
.alert-text-small   { font-size: 80%;  }
.alert-text-large   { font-size: 130%; }
.alert-text-normal  { font-size: 90%;  }
.alert {
  padding:8px 35px 8px 14px; margin-bottom:18px;
  text-shadow:0 1px 0 rgba(255,255,255,0.5);
  border:1px solid #bababa;
  border-radius: 4px;
  -webkit-border-radius: 4px;
  -moz-border-radius: 4px;
  color: #555;
  background-color: #f8f8f8;
  background-position: 10px 5px;
  background-repeat: no-repeat;
  background-size: 38px;
  padding-left: 55px;
  width: 75%;
 }
.alert-block {padding-top:14px; padding-bottom:14px}
.alert-block > p, .alert-block > ul {margin-bottom:1em}
.alert li {margin-top: 1em}
.alert-block p+p {margin-top:5px}
.alert-notice { background-image: url(https://cdn.rawgit.com/hplgit/doconce/master/bundled/html_images/small_gray_notice.png); }
.alert-summary  { background-image:url(https://cdn.rawgit.com/hplgit/doconce/master/bundled/html_images/small_gray_summary.png); }
.alert-warning { background-image: url(https://cdn.rawgit.com/hplgit/doconce/master/bundled/html_images/small_gray_warning.png); }
.alert-question {background-image:url(https://cdn.rawgit.com/hplgit/doconce/master/bundled/html_images/small_gray_question.png); }

div { text-align: justify; text-justify: inter-word; }

    </style>


</head>

<!-- tocinfo
{'highest level': 1,
 'sections': [('Web frameworks', 1, None, '___sec0'),
              ('Other frameworks', 3, None, '___sec1'),
              ('The MVC pattern', 2, None, '___sec2'),
              ('A very simple application', 2, None, '___sec3'),
              ('Application of the MVC pattern', 2, 'wf:hw:mvc', 'wf:hw:mvc'),
              ('Making a Flask application', 1, None, '___sec5'),
              ('Programming the Flask application', 2, None, '___sec6'),
              ('The user interaction', 3, None, '___sec7'),
              ('The Python code', 3, None, '___sec8'),
              ('Dissection', 3, None, '___sec9'),
              ('The template files', 3, None, '___sec10'),
              ('Testing the application', 3, None, '___sec11'),
              ('Equipping the input page with output results',
               2,
               None,
               '___sec12'),
              ('Splitting the app into model, view, and controller files',
               2,
               'wf:hw3:flask',
               'wf:hw3:flask'),
              ('Troubleshooting', 2, None, '___sec14'),
              ('Address already in use', 3, None, '___sec15'),
              ('Making a Django application', 1, None, '___sec16'),
              ('Setting up a Django project', 2, None, '___sec17'),
              ('Setting up a Django application', 2, None, '___sec18'),
              ('Programming the Django application', 2, None, '___sec19'),
              ('The user interaction', 3, None, '___sec20'),
              ('The model', 3, None, '___sec21'),
              ('The view', 3, None, '___sec22'),
              ('Making the input page', 3, None, '___sec23'),
              ('Making the results page', 3, None, '___sec24'),
              ('Equipping the input page with output results',
               2,
               None,
               '___sec25'),
              ('Handling multiple input variables in Flask',
               1,
               'wf:vib:flask',
               'wf:vib:flask'),
              ('Programming the Flask application',
               2,
               'wf:vib1:flask:app',
               'wf:vib1:flask:app'),
              ('The compute part', 3, None, '___sec28'),
              ('The model', 3, None, '___sec29'),
              ('The view', 3, None, '___sec30'),
              ('The HTML template', 3, None, '___sec31'),
              ('Implementing error checking in the template',
               2,
               None,
               '___sec32'),
              ('Using style sheets', 2, None, '___sec33'),
              ('Using LaTeX mathematics', 2, None, '___sec34'),
              ('Rearranging the elements in the HTML template',
               2,
               None,
               '___sec35'),
              ('Bootstrap HTML style', 2, None, '___sec36'),
              ('Custom validation',
               2,
               'wf:vib1:flask:validation',
               'wf:vib1:flask:validation'),
              ('Using Flask validators', 3, None, '___sec38'),
              ('Tailored validation', 3, None, '___sec39'),
              ('Tailored validation of intervals', 3, None, '___sec40'),
              ('Demo', 3, None, '___sec41'),
              ('Avoiding plot files',
               2,
               'wf:vib2:flask:nofiles',
               'wf:vib2:flask:nofiles'),
              ('PNG plots', 3, None, '___sec43'),
              ('SVG plots', 3, None, '___sec44'),
              ('Using mpld3', 3, None, '___sec45'),
              ('Plotting with the Bokeh library',
               2,
               'wf:bokeh:flask',
               'wf:bokeh:flask'),
              ('Pandas highcharts plotting library', 3, None, '___sec47'),
              ('Autogenerating the code',
               2,
               'wf:autogen:flask',
               'wf:autogen:flask'),
              ('Inspecting function signatures', 3, None, '___sec49'),
              ('Generating the model', 3, None, '___sec50'),
              ('Generating the view', 3, None, '___sec51'),
              ('Generating the template', 3, None, '___sec52'),
              ('Application', 3, None, '___sec53'),
              ('User login and storage of computed results',
               2,
               'wf:flask:login',
               'wf:flask:login'),
              ('Required additional software', 3, None, '___sec55'),
              ('The compute part', 3, None, '___sec56'),
              ('The interfaces of the app', 3, None, '___sec57'),
              ('The source code', 3, None, '___sec58'),
              ('Resources', 3, None, '___sec59'),
              ('Uploading of files', 2, 'wf:flask:upload', 'wf:flask:upload'),
              ('Overview of the application', 3, None, '___sec61'),
              ('The model class', 3, None, '___sec62'),
              ('The controller file', 3, None, '___sec63'),
              ('The compute function', 3, None, '___sec64'),
              ('The HTML template', 3, None, '___sec65'),
              ('Handling multiple input variables in Django',
               1,
               'wf:vib:django',
               'wf:vib:django'),
              ('Programming the Django application', 2, None, '___sec67'),
              ('Adding the app to a project', 3, None, '___sec68'),
              ('The compute part', 3, None, '___sec69'),
              ('The model', 3, None, '___sec70'),
              ('The view', 3, None, '___sec71'),
              ('Custom validation', 2, None, '___sec72'),
              ('Customizing widgets', 2, None, '___sec73'),
              ('Resources', 2, None, '___sec74'),
              ('Exercises', 1, None, '___sec75'),
              ('Exercise 1: Add two numbers',
               2,
               'wf:exer:add2',
               'wf:exer:add2'),
              ('Exercise 2: Upload data file and visualize curves',
               2,
               'wf:exer:upload',
               'wf:exer:upload'),
              ('Exercise 3: Plot a user-specified formula',
               2,
               'wf:exer:formula',
               'wf:exer:formula'),
              ('Exercise 4: Visualize Taylor polynomial approximations',
               2,
               'wf:exer:Taylor',
               'wf:exer:Taylor'),
              ('Exercise 5: Extend the `gen` app',
               2,
               'wf:exer:gen:demo',
               'wf:exer:gen:demo'),
              ('Exercise 6: Make a web app with multiple apps',
               2,
               'wf:exer:addmul',
               'wf:exer:addmul'),
              ('Exercise 7: Equip the `gen` app with more data types',
               2,
               'wf:exer:gen:lists',
               'wf:exer:gen:lists'),
              ('Exercise 8: Auto-generate code from function signature',
               2,
               None,
               '___sec83'),
              ('Project 9: Interactive function exploration',
               2,
               'wf:exer:bokeh_UI',
               'wf:exer:bokeh_UI'),
              ('Resources', 1, None, '___sec85'),
              ('Flask resources', 2, None, '___sec86'),
              ('Django resources', 2, None, '___sec87')]}
end of tocinfo -->

<body>


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "none"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js", "color.js"]
  }
});

</script>
<script type="text/javascript"
        src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<a name="part0015"></a>
<p>
    <!-- begin top navigation -->
<table style="width: 100%">
    <tr>
        <td>
            <div style="text-align: left;"><a href="._web4sa_plain014.html">&laquo; Previous</a></div>
        </td>
        <td>
            <div style="text-align: right;"><a href="._web4sa_plain016.html">Next &raquo;</a></div>
        </td>
    </tr>
</table>
<!-- end top navigation -->
</p>

<p>
    <!-- !split -->

<h2 id="wf:vib2:flask:nofiles">Avoiding plot files</h2>

<p>
    Files with plots are easy to deal with as long as they are in the
    <code>static</code> subdirectory of the Flask application directory. However,
    as already pointed out, the previous <code>vib1</code> app, which writes plot
    files, is not suited for multiple simultaneous users since every
    user will destroy <em>all</em> existing plot files before making a new
    one. Therefore, we need a robust solution for multiple users of
    the app.

<p>
    The idea is to not write plot files, but instead return the plot
    as a string and embed that string directly in the HTML code.
    This is relatively straightforward with Matplotlib
    and Python. The relevant code is found in the <code>compute.py</code> file
    of the <code>vib2</code> app.

<h3 id="___sec43">PNG plots </h3>

<p>
    Python has the <code>io.StringIO</code> object for writing text to a
    string buffer with the same syntax as used for writing text to
    files. For binary streams, such as PNG files, one can use
    a similar object, <code>io.BytesIO</code>, to hold the stream (i.e., the plot file)
    in memory. The idea is to let Matplotlib write to
    a <code>io.BytesIO</code> object and afterwards extract the
    series of bytes in the plot file from this object and embed it in
    the HTML file directly. This approach avoids storing plots in separate
    files, at the cost of bigger HTML files.

<p>
    The first step is to let Matplotlib write the PNG data to
    the <code>BytesIO</code> buffer:

<p>

    <!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span
        style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">matplotlib.pyplot</span> <span
        style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">plot</span>
<span style="color: #008000; font-weight: bold">from</span> <span
            style="color: #0000FF; font-weight: bold">io</span> <span
            style="color: #008000; font-weight: bold">import</span> BytesIO
<span style="color: #408080; font-style: italic"># run plt.plot, plt.title, etc.</span>
figfile <span style="color: #666666">=</span> BytesIO()
plt<span style="color: #666666">.</span>savefig(figfile, format<span style="color: #666666">=</span><span
            style="color: #BA2121">&#39;png&#39;</span>)
figfile<span style="color: #666666">.</span>seek(<span style="color: #666666">0</span>)  <span
            style="color: #408080; font-style: italic"># rewind to beginning of file</span>
figdata_png <span style="color: #666666">=</span> figfile<span style="color: #666666">.</span>getvalue()  <span
            style="color: #408080; font-style: italic"># extract string (stream of bytes)</span>
</pre>
</div>
<p>
    Before the PNG data can be embedded in HTML we need to convert the
    data to base64 format:

<p>

    <!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span
        style="color: #008000; font-weight: bold">import</span> <span
        style="color: #0000FF; font-weight: bold">base64</span>
figdata_png <span style="color: #666666">=</span> base64<span style="color: #666666">.</span>b64encode(figdata_png)
</pre>
</div>
<p>
    Now we can embed the PNG data in HTML by

<p>

    <!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span
        style="color: #666666">&lt;</span>img src<span style="color: #666666">=</span><span style="color: #BA2121">&quot;data:image/png;base64,PLOTSTR&quot;</span> width<span
        style="color: #666666">=</span><span style="color: #BA2121">&quot;500&quot;</span><span style="color: #666666">&gt;</span>
</pre>
</div>
<p>
    where <code>PLOTSTR</code> is the content of the string <code>figdata_png</code>.

<p>
    The complete <code>compute.py</code> function takes the form

<p>

    <!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span
        style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">compute</span>(A, b, w, T, resolution<span
        style="color: #666666">=500</span>):
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Return filename of plot of the damped_vibration function.&quot;&quot;&quot;</span>
    t <span style="color: #666666">=</span> linspace(<span style="color: #666666">0</span>, T, resolution<span
            style="color: #666666">+1</span>)
    u <span style="color: #666666">=</span> damped_vibrations(t, A, b, w)
    plt<span style="color: #666666">.</span>figure()  <span style="color: #408080; font-style: italic"># needed to avoid adding curves in plot</span>
    plt<span style="color: #666666">.</span>plot(t, u)
    plt<span style="color: #666666">.</span>title(<span style="color: #BA2121">&#39;A=</span><span
            style="color: #BB6688; font-weight: bold">%g</span><span style="color: #BA2121">, b=</span><span
            style="color: #BB6688; font-weight: bold">%g</span><span style="color: #BA2121">, w=</span><span
            style="color: #BB6688; font-weight: bold">%g</span><span style="color: #BA2121">&#39;</span> <span
            style="color: #666666">%</span> (A, b, w))

    <span style="color: #408080; font-style: italic"># Make Matplotlib write to BytesIO file object and grab</span>
    <span style="color: #408080; font-style: italic"># return the object&#39;s string</span>
    <span style="color: #008000; font-weight: bold">from</span> <span
            style="color: #0000FF; font-weight: bold">io</span> <span
            style="color: #008000; font-weight: bold">import</span> BytesIO
    figfile <span style="color: #666666">=</span> BytesIO()
    plt<span style="color: #666666">.</span>savefig(figfile, format<span style="color: #666666">=</span><span
            style="color: #BA2121">&#39;png&#39;</span>)
    figfile<span style="color: #666666">.</span>seek(<span style="color: #666666">0</span>)  <span
            style="color: #408080; font-style: italic"># rewind to beginning of file</span>
    <span style="color: #008000; font-weight: bold">import</span> <span
            style="color: #0000FF; font-weight: bold">base64</span>
    figdata_png <span style="color: #666666">=</span> base64<span style="color: #666666">.</span>b64encode(figfile<span
            style="color: #666666">.</span>getvalue())
    <span style="color: #008000; font-weight: bold">return</span> figdata_png
</pre>
</div>
<p>
    The relevant syntax in an HTML template is

<p>

    <!-- code=html (!bc htmlcod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span
        style="color: #008000; font-weight: bold">&lt;img</span> <span style="color: #7D9029">src=</span><span
        style="color: #BA2121">&quot;data:image/png;base64,{{ results }}&quot;</span> <span style="color: #7D9029">width=</span><span
        style="color: #BA2121">&quot;500&quot;</span><span style="color: #008000; font-weight: bold">&gt;</span>
</pre>
</div>
<p>
    if <code>results</code> holds the returned object from the <code>compute</code> function above.

<h3 id="___sec44">SVG plots </h3>

<p>
    Inline figures in HTML, instead of using files, are most often realized
    by XML code with the figure data in SVG format.
    Plot strings in the SVG format are created very similarly to the PNG
    example:

<p>

    <!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">figfile <span
        style="color: #666666">=</span> BytesIO()
plt<span style="color: #666666">.</span>savefig(figfile, format<span style="color: #666666">=</span><span
            style="color: #BA2121">&#39;svg&#39;</span>)
figdata_svg <span style="color: #666666">=</span> figfile<span style="color: #666666">.</span>getvalue()
</pre>
</div>
<p>
    The <code>figdata_svg</code> string contains XML code text can almost
    be directly embedded in
    HTML5. However, the beginning of the text contains information before
    the <code>svg</code> tag that we want to remove:

<p>

    <!-- code=text (!bc dat) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; standalone=&quot;no&quot;?&gt;
&lt;!DOCTYPE svg PUBLIC &quot;-//W3C//DTD SVG 1.1//EN&quot;
  &quot;http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd&quot;&gt;
&lt;!-- Created with matplotlib (http://matplotlib.sourceforge.net/) --&gt;
&lt;svg height=&quot;441pt&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 585 441&quot; ...
</pre>
</div>
<p>
    The removal is done with a little string manipulation:

<p>

    <!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">figdata_svg <span
        style="color: #666666">=</span> <span style="color: #BA2121">&#39;&lt;svg&#39;</span> <span
        style="color: #666666">+</span> figfile<span style="color: #666666">.</span>getvalue()<span
        style="color: #666666">.</span>split(<span style="color: #BA2121">&#39;&lt;svg&#39;</span>)[<span
        style="color: #666666">1</span>]
</pre>
</div>
<p>
    Now, <code>figdata_svg</code> can be directly inserted in HTML code without
    any surrounding tags (because it is perfectly valid HTML code in itself).

<p>
    The SVG code generated by Matplotlib may contain UTF-8 characters
    so it is necessary to make a unicode string out of the text:
    <code>unicode(figdata_svg, 'utf-8')</code>, otherwise the HTML template will
    lead to an encoding exception.

<p>
    We have made an alternative compute function <code>compute_png_svg</code>
    that returns both a PNG and an SVG plot:

<p>

    <!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span
        style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">compute_png_svg</span>(A, b, w, T, resolution<span
        style="color: #666666">=500</span>):
    <span style="color: #666666">...</span>
    figfile <span style="color: #666666">=</span> BytesIO()
    plt<span style="color: #666666">.</span>savefig(figfile, format<span style="color: #666666">=</span><span
            style="color: #BA2121">&#39;svg&#39;</span>)
    figfile<span style="color: #666666">.</span>seek(<span style="color: #666666">0</span>)
    figdata_svg <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;&lt;svg&#39;</span> <span
            style="color: #666666">+</span> figfile<span style="color: #666666">.</span>getvalue()<span
            style="color: #666666">.</span>split(<span style="color: #BA2121">&#39;&lt;svg&#39;</span>)[<span
            style="color: #666666">1</span>]
    figdata_svg <span style="color: #666666">=</span> <span style="color: #008000">unicode</span>(figdata_svg, <span
            style="color: #BA2121">&#39;utf-8&#39;</span>)
    <span style="color: #008000; font-weight: bold">return</span> figdata_png, figdata_svg
</pre>
</div>
<p>
    The relevant syntax for inserting an SVG plot in the HTML template is now

<p>

    <!-- code=html (!bc htmlcod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">{{ result[1]|safe }}
</pre>
</div>
<p>
    The use of <code>safe</code> is essential here.

<p>
    <div class="alert alert-block alert-notice alert-text-normal">
        <b>Important: use <code>safe</code> for verbatim HTML code:</b>
<p>
    Special HTML characters like <code>&lt;</code>, <code>&gt;</code>,
    <code>&</code>, <code>&quot;</code>, and <code>'</code> are escaped in a template string like <code>{{ str }}</code>
    (i.e., <code>&</code> is replaced by <code>&amp;</code> `<` is replaced by <code>&lt;</code>, etc.).
    We need to avoid this manipulation of the string content
    because <code>result[1]</code> contains
    XML code where the mentioned characters are essential part of the syntax.
    Writing <code>{{str|safe}}</code> ensures that the contents of the string <code>str</code>
    are not altered before being embedded in the HTML text.
    </div>


<p>
    An alternative template, <code>view_svg.html</code> applies the SVG plot instead
    of the PNG plot. We use the command-line argument <code>svg</code> for indicating
    that we want an SVG instead of a PNG plot:

<p>

    <!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span
        style="color: #408080; font-style: italic"># SVG or PNG plot?</span>
svg <span style="color: #666666">=</span> <span style="color: #008000">False</span>
<span style="color: #008000; font-weight: bold">try</span>:
    <span style="color: #008000; font-weight: bold">if</span> sys<span style="color: #666666">.</span>argv[<span
            style="color: #666666">1</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;svg&#39;</span>:
        svg <span style="color: #666666">=</span> <span style="color: #008000">True</span>
<span style="color: #008000; font-weight: bold">except</span> <span
            style="color: #D2413A; font-weight: bold">IndexError</span>:
    <span style="color: #008000; font-weight: bold">pass</span>
<span style="color: #008000; font-weight: bold">if</span> svg:
    <span style="color: #008000; font-weight: bold">from</span> <span
            style="color: #0000FF; font-weight: bold">compute</span> <span style="color: #008000; font-weight: bold">import</span> compute_png_svg <span
            style="color: #008000; font-weight: bold">as</span> compute
    template <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;view_svg.html&#39;</span>
<span style="color: #008000; font-weight: bold">else</span>:
    <span style="color: #008000; font-weight: bold">from</span> <span
            style="color: #0000FF; font-weight: bold">compute</span> <span style="color: #008000; font-weight: bold">import</span> compute
    template <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;view.html&#39;</span>
</pre>
</div>

<h3 id="___sec45">Using mpld3 </h3>

<p>
    The <a href="http://mpld3.github.io" target="_self">mpld3</a> library can convert Matplotlib
    plots to HTML code that can be directly embedded in a web page. Here
    is a basic example:

<p>

    <!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span
        style="color: #408080; font-style: italic"># Plot array y vs x</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">matplotlib.pyplot</span> <span
            style="color: #008000; font-weight: bold">as</span> <span
            style="color: #0000FF; font-weight: bold">plt</span><span style="color: #666666">,</span> <span
            style="color: #0000FF; font-weight: bold">mpld3</span>
fig, ax <span style="color: #666666">=</span> plt<span style="color: #666666">.</span>subplots()
ax<span style="color: #666666">.</span>plot(x, y)
html_text <span style="color: #666666">=</span> mpld3<span style="color: #666666">.</span>fig_to_html(fig)
</pre>
</div>
<p>
    The string <code>html_text</code> contains all the HTML code that is needed to
    display the plot.

<p>
    The great advantage of the <code>mpld3</code> library is that it contains
    capabilities for creating custom interactive plots through combining
    Matplotlib with JavaScript, see the <a href="http://mpld3.github.io/examples/index.html#example-gallery"
                                           target="_self">mpld3 Example Gallery</a>.

<h2 id="wf:bokeh:flask">Plotting with the Bokeh library</h2>

<p>
    As an alternative to using Matplotlib for plotting, we can utilize
    the <a href="http://bokeh.pydata.org/en/latest/" target="_self">Bokeh</a> tool, which is
    particularly developed for graphics in web browsers.
    The <a href="https://github.com/hplgit/web4sciapps/tree/master/doc/src/web4sa/src-web4sa/apps/flask_apps/vib3"
           target="_self"><tt>vib3</tt></a> app is similar to the
    previously described <code>vib1</code> and <code>vib2</code> app, except that we make one plot with
    Bokeh. Only the <code>compute.py</code> and <code>view.html</code> files
    are different. Obviously, we need to run Bokeh in the compute function.
    Normally, Bokeh stores the HTML code for the plot in a file
    with a specified name. We can load the text in this file and
    extract the relevant HTML code for a plot. However, it is easier to
    use <a href="http://bokeh.pydata.org/en/latest/docs/user_guide/embed.html" target="_self">Bokeh tools</a> for
    returning the HTML code elements directly.
    The steps are exemplified in the <code>compute.py</code> file:

<p>

    <!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span
        style="color: #008000; font-weight: bold">from</span> <span
        style="color: #0000FF; font-weight: bold">numpy</span> <span
        style="color: #008000; font-weight: bold">import</span> exp, cos, linspace
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">bokeh.plotting</span> <span
            style="color: #008000; font-weight: bold">as</span> <span
            style="color: #0000FF; font-weight: bold">plt</span>
<span style="color: #008000; font-weight: bold">import</span> <span
            style="color: #0000FF; font-weight: bold">os</span><span style="color: #666666">,</span> <span
            style="color: #0000FF; font-weight: bold">re</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">damped_vibrations</span>(t, A, b, w):
    <span style="color: #008000; font-weight: bold">return</span> A<span style="color: #666666">*</span>exp(<span
            style="color: #666666">-</span>b<span style="color: #666666">*</span>t)<span style="color: #666666">*</span>cos(w<span
            style="color: #666666">*</span>t)

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">compute</span>(A, b, w, T, resolution<span
            style="color: #666666">=500</span>):
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Return filename of plot of the damped_vibration function.&quot;&quot;&quot;</span>
    t <span style="color: #666666">=</span> linspace(<span style="color: #666666">0</span>, T, resolution<span
            style="color: #666666">+1</span>)
    u <span style="color: #666666">=</span> damped_vibrations(t, A, b, w)

    <span style="color: #408080; font-style: italic"># create a new plot with a title and axis labels</span>
    TOOLS <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;pan,wheel_zoom,box_zoom,reset,save,box_select,lasso_select&quot;</span>
    p <span style="color: #666666">=</span> plt<span style="color: #666666">.</span>figure(title<span
            style="color: #666666">=</span><span
            style="color: #BA2121">&quot;simple line example&quot;</span>, tools<span style="color: #666666">=</span>TOOLS,
                   x_axis_label<span style="color: #666666">=</span><span style="color: #BA2121">&#39;t&#39;</span>, y_axis_label<span
            style="color: #666666">=</span><span style="color: #BA2121">&#39;y&#39;</span>)

    <span style="color: #408080; font-style: italic"># add a line renderer with legend and line thickness</span>
    p<span style="color: #666666">.</span>line(t, u, legend<span style="color: #666666">=</span><span
            style="color: #BA2121">&quot;u(t)&quot;</span>, line_width<span style="color: #666666">=2</span>)

    <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">bokeh.resources</span> <span
            style="color: #008000; font-weight: bold">import</span> CDN
    <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">bokeh.embed</span> <span
            style="color: #008000; font-weight: bold">import</span> components
    script, div <span style="color: #666666">=</span> components(p)
    head <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;&quot;&quot;</span>
<span style="color: #BA2121">&lt;link rel=&quot;stylesheet&quot;</span>
<span style="color: #BA2121"> href=&quot;http://cdn.pydata.org/bokeh/release/bokeh-0.9.0.min.css&quot;</span>
<span style="color: #BA2121"> type=&quot;text/css&quot; /&gt;</span>
<span style="color: #BA2121">&lt;script type=&quot;text/javascript&quot;</span>
<span style="color: #BA2121"> src=&quot;http://cdn.pydata.org/bokeh/release/bokeh-0.9.0.min.js&quot;&gt;</span>
<span style="color: #BA2121">&lt;/script&gt;</span>
<span style="color: #BA2121">&lt;script type=&quot;text/javascript&quot;&gt;</span>
<span style="color: #BA2121">Bokeh.set_log_level(&quot;info&quot;);</span>
<span style="color: #BA2121">&lt;/script&gt;</span>
<span style="color: #BA2121">&quot;&quot;&quot;</span>
    <span style="color: #008000; font-weight: bold">return</span> head, script, div
</pre>
</div>
<p>
    The key data returned from <code>compute</code> consists of a text for loading Bokeh
    tools in the <code>head</code> part of the HTML document (common for all plots in
    the file) and for the plot itself there is a <code>script</code> tag and a <code>div</code> tag. The
    <code>script</code> tag can be placed anywhere, while the <code>div</code> tag must be placed
    exactly where we want to have the plot. In case of multiple plots,
    there will be a common <code>script</code> tag and one <code>div</code> tag for each plot.

<p>
    We need to insert the three elements return from <code>compute</code>,
    available in the tuple <code>result</code>, into the <code>view.html</code> file.
    The link and scripts for Bokeh tools in <code>result[0]</code> is inserted
    in the <code>head</code> part, while the script and div tags for the plot
    is inserted where we want to have to plot.
    The complete <code>view.html</code> file looks like this:

<p>

    <!-- code=html (!bc htmlpro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #BC7A00">&lt;!DOCTYPE html&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;html</span> <span style="color: #7D9029">lang=</span><span
            style="color: #BA2121">&quot;en&quot;</span><span style="color: #008000; font-weight: bold">&gt;</span>
   <span style="color: #008000; font-weight: bold">&lt;head&gt;</span>
    {{ result[0]|safe }}
<span style="color: #008000; font-weight: bold">&lt;/head&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;body&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;script </span><span style="color: #7D9029">type=</span><span
            style="color: #BA2121">&quot;text/x-mathjax-config&quot;</span><span
            style="color: #008000; font-weight: bold">&gt;</span>
MathJax.Hub.Config({
  TeX<span style="color: #666666">:</span> {
     equationNumbers<span style="color: #666666">:</span> {  autoNumber<span style="color: #666666">:</span> <span
            style="color: #BA2121">&quot;AMS&quot;</span>  },
     extensions<span style="color: #666666">:</span> [<span style="color: #BA2121">&quot;AMSmath.js&quot;</span>, <span
            style="color: #BA2121">&quot;AMSsymbols.js&quot;</span>, <span style="color: #BA2121">&quot;autobold.js&quot;</span>]
  }
});
<span style="color: #008000; font-weight: bold">&lt;/script&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;script </span><span style="color: #7D9029">type=</span><span
            style="color: #BA2121">&quot;text/javascript&quot;</span> <span style="color: #7D9029">src=</span>
<span style="color: #BA2121">&quot;http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML&quot;</span><span
            style="color: #008000; font-weight: bold">&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;/script&gt;</span>

This web page visualizes the function \(
u(t) = Ae^{-bt}\sin (w t), \hbox{ for } t\in [0,T]
\).

<span style="color: #008000; font-weight: bold">&lt;form</span> <span style="color: #7D9029">method=</span><span
            style="color: #BA2121">post</span> <span style="color: #7D9029">action=</span><span style="color: #BA2121">&quot;&quot;</span><span
            style="color: #008000; font-weight: bold">&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;table&gt;</span>
  {% for field in form %}
    <span style="color: #008000; font-weight: bold">&lt;tr&gt;</span>
    <span style="color: #008000; font-weight: bold">&lt;td</span> <span style="color: #7D9029">class=</span><span
            style="color: #BA2121">&quot;name&quot;</span><span style="color: #008000; font-weight: bold">&gt;</span>\( {{ field.name }} \) <span
            style="color: #999999; font-weight: bold">&amp;nbsp;&amp;nbsp;</span><span
            style="color: #008000; font-weight: bold">&lt;/td&gt;</span>
    <span style="color: #008000; font-weight: bold">&lt;td&gt;</span>{{ field(size=12) }}<span
            style="color: #008000; font-weight: bold">&lt;/td&gt;</span>
    <span style="color: #008000; font-weight: bold">&lt;td&gt;</span>{{ field.label }}<span
            style="color: #008000; font-weight: bold">&lt;/td&gt;</span>
    {% if field.errors %}
      <span style="color: #008000; font-weight: bold">&lt;td&gt;&lt;ul</span> <span style="color: #7D9029">class=</span><span
            style="color: #BA2121">errors</span><span style="color: #008000; font-weight: bold">&gt;</span>
      {% for error in field.errors %}
        <span style="color: #008000; font-weight: bold">&lt;li&gt;&lt;font</span> <span
            style="color: #7D9029">color=</span><span style="color: #BA2121">&quot;red&quot;</span><span
            style="color: #008000; font-weight: bold">&gt;</span>{{ error }}<span
            style="color: #008000; font-weight: bold">&lt;/font&gt;&lt;/li&gt;</span>
      {% endfor %}<span style="color: #008000; font-weight: bold">&lt;/ul&gt;&lt;/td&gt;</span>
    {% endif %}
    <span style="color: #008000; font-weight: bold">&lt;/tr&gt;</span>
  {% endfor %}
<span style="color: #008000; font-weight: bold">&lt;/table&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;p&gt;&lt;input</span> <span style="color: #7D9029">type=</span><span
            style="color: #BA2121">&quot;submit&quot;</span> <span style="color: #7D9029">value=</span><span
            style="color: #BA2121">&quot;Compute&quot;</span><span style="color: #008000; font-weight: bold">&gt;&lt;/form&gt;&lt;/p&gt;</span>

<span style="color: #008000; font-weight: bold">&lt;p&gt;</span>
{% if result != None %}
<span style="color: #408080; font-style: italic">&lt;!-- script and div elements for Bokeh plot --&gt;</span>
{{ result[1]|safe }}
{{ result[2]|safe }}
{% endif %}
<span style="color: #008000; font-weight: bold">&lt;/p&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;/body&gt;</span>
<span style="color: #008000; font-weight: bold">&lt;/html&gt;</span>
</pre>
</div>
<p>
    A feature of Bokeh plots is that one can zoom, pan, and save
    to PNG file, among other
    things. There is a toolbar at the top for such actions.

<p>
    The <code>controller.py</code> file is basically the same as before (but simpler
    than in the <code>vib2</code> app since we do not deal with PNG and/or SVG plots):

<p>

    <!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span
        style="color: #008000; font-weight: bold">from</span> <span
        style="color: #0000FF; font-weight: bold">model</span> <span
        style="color: #008000; font-weight: bold">import</span> InputForm
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">flask</span> <span
            style="color: #008000; font-weight: bold">import</span> Flask, render_template, request
<span style="color: #008000; font-weight: bold">from</span> <span
            style="color: #0000FF; font-weight: bold">compute</span> <span style="color: #008000; font-weight: bold">import</span> compute

app <span style="color: #666666">=</span> Flask(__name__)

<span style="color: #AA22FF">@app.route</span>(<span style="color: #BA2121">&#39;/vib3&#39;</span>, methods<span
            style="color: #666666">=</span>[<span style="color: #BA2121">&#39;GET&#39;</span>, <span
            style="color: #BA2121">&#39;POST&#39;</span>])
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">index</span>():
    form <span style="color: #666666">=</span> InputForm(request<span style="color: #666666">.</span>form)
    <span style="color: #008000; font-weight: bold">if</span> request<span style="color: #666666">.</span>method <span
            style="color: #666666">==</span> <span style="color: #BA2121">&#39;POST&#39;</span> <span
            style="color: #AA22FF; font-weight: bold">and</span> form<span style="color: #666666">.</span>validate():
        <span style="color: #008000; font-weight: bold">for</span> field <span
            style="color: #AA22FF; font-weight: bold">in</span> form:
            <span style="color: #408080; font-style: italic"># Make local variable (name field.name)</span>
            <span style="color: #008000; font-weight: bold">exec</span>(<span style="color: #BA2121">&#39;</span><span
            style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121"> = </span><span
            style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">&#39;</span> <span
            style="color: #666666">%</span> (field<span style="color: #666666">.</span>name, field<span
            style="color: #666666">.</span>data))
        result <span style="color: #666666">=</span> compute(A, b, w, T)
    <span style="color: #008000; font-weight: bold">else</span>:
        result <span style="color: #666666">=</span> <span style="color: #008000">None</span>

    <span style="color: #008000; font-weight: bold">return</span> render_template(<span style="color: #BA2121">&#39;view.html&#39;</span>, form<span
            style="color: #666666">=</span>form,
                           result<span style="color: #666666">=</span>result)

<span style="color: #008000; font-weight: bold">if</span> __name__ <span style="color: #666666">==</span> <span
            style="color: #BA2121">&#39;__main__&#39;</span>:
    app<span style="color: #666666">.</span>run(debug<span style="color: #666666">=</span><span style="color: #008000">True</span>)
</pre>
</div>
<p>
    Finally, we remark that Bokeh plays very well with Flask.
    <a href="._web4sa_plain021.html#wf:exer:bokeh_UI">Project 9: Interactive function exploration</a> suggests a web app
    that combines
    Bokeh with Flask in a very interactive way.

<h3 id="___sec47">Pandas highcharts plotting library </h3>

<p>
    The <a href="https://pypi.python.org/pypi/pandas-highcharts/" target="_self">pandas-highcharts</a>
    package is another strong alternative to Bokeh for interative
    plotting in web pages. It is a stable and widely used code.

<p>
<p>
    <!-- begin bottom navigation -->
<table style="width: 100%">
    <tr>
        <td>
            <div style="text-align: left;"><a href="._web4sa_plain014.html">&laquo; Previous</a></div>
        </td>
        <td>
            <div style="text-align: right;"><a href="._web4sa_plain016.html">Next &raquo;</a></div>
        </td>
    </tr>
</table>
<!-- end bottom navigation -->
</p>

<!-- ------------------- end of main content --------------- -->


<center style="font-size:80%">
    <!-- copyright only on the titlepage -->
</center>


</body>
</html>
    

